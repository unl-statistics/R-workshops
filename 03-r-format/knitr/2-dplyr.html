<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>dplyr</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.8/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <link href="libs/bokehjs-0.12.5/bokeh.min.css" rel="stylesheet" />
    <link href="libs/bokehjs-0.12.5/loader.css" rel="stylesheet" />
    <script src="libs/bokehjs-0.12.5/bokeh.min.js"></script>
    <script src="libs/rbokeh-binding-0.5.2/rbokeh.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# dplyr
### 

---





## The pipe operator `%&gt;%`

`f(x) %&gt;% g(y)` is equivalent to `g(f(x), y)`

i.e. the output of one function is used as input to the next function. This function can be the identity

Consequences:

- `x %&gt;% f(y)` is the same as `f(x, y)`

- statements of the form `k(h(g(f(x, y), z), u), v, w)` become
`x %&gt;% f(y) %&gt;% g(z) %&gt;% h(u) %&gt;% k(v, w)`

- read `%&gt;%` as "then do"

- in non-mathematical terms, the piping operator allows you to apply more than one different function at the same time to the same data frame.

---
## dplyr terminology

There are some of the primary `dplyr` *verbs*, representing distinct data analysis tasks:

- **Filter**: Select specified rows of a data frame, produce subsets

- **Arrange**: Reorder the rows of a data frame

- **Select**: Select particular columns of a data frame

- **Mutate**: Add new or change existing columns of the data frame (as functions of existing columns)

- **Summarise**: Create collapsed summaries of a data frame

- **Group By**: Introduce structure to a data frame
 
 
---

## Filter

Read in the pitch data set (in the folder 03-r-format/data). The data are from an experiment on different advanced metrics of a MLB baseball pitchers different pitch types.


```r
library(tidyverse)
curve &lt;- read_csv("../data/pitchdata.csv")
curve %&gt;% 
  filter(pitcher_hand == "R", pitch_type == "CU") %&gt;% 
  head(3)
```

```
## # A tibble: 3 × 31
##   playerid batter_stand pitcher_hand prev_pitch_type prev_start_speed prev_px 
##      &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;   
## 1     3103 R            R            "\\N"           "\\N"            "\\N"   
## 2     3103 R            R            "KN"            "68.09"          "-0.320"
## 3     2309 R            R            "SL"            "61.64"          "0.180" 
## # … with 25 more variables: prev_pz &lt;chr&gt;, pitch_type &lt;chr&gt;, px &lt;dbl&gt;,
## #   pz &lt;dbl&gt;, start_speed &lt;dbl&gt;, x0 &lt;dbl&gt;, y0 &lt;dbl&gt;, z0 &lt;dbl&gt;, vx0 &lt;dbl&gt;,
## #   vy0 &lt;dbl&gt;, vz0 &lt;dbl&gt;, ax &lt;dbl&gt;, ay &lt;dbl&gt;, az &lt;dbl&gt;, exit_velocity &lt;dbl&gt;,
## #   pfx_x &lt;dbl&gt;, pfx_z &lt;dbl&gt;, spin_dir &lt;dbl&gt;, spin_rate &lt;dbl&gt;, ball &lt;dbl&gt;,
## #   strike &lt;dbl&gt;, action_result &lt;chr&gt;, ab_result &lt;chr&gt;, adj_h &lt;dbl&gt;,
## #   adj_tb &lt;dbl&gt;
```

`filter` is similar to the base function `subset`

---
## Filter (cont.)

Multiple conditions in `filter` are combined with a logical AND (i.e. all conditions must be fulfilled) 

e.g. `filter(pitcher_hand == "R", pitch_type == "CU")`

Logical expressions can also be used 

e.g. `filter(pitcher_hand == "R" &amp;  pitch_type == "CU")` or 
`filter(pitch_type == "CU" | subject == "KN")`

---
class: inverse
## Your Turn (~3 minutes) 

1. Use `filter` to get a subset of the `pitchdata` dataset

2. Ex. Filter the data down to left handed pitchers, who throw a curve with at least
3300 rpms (spin_rate), and the play results in a ball (action_result).

3. `%&gt;%` the subset and create a plot

hint: what is the default first argument of the `ggplot` function?

---

## One Solution 


```r
  pitch %&gt;%
  filter(spin_rate &gt;= 3200 &amp; pitcher_hand == "L") %&gt;%
  ggplot(aes(x=action_result, y=spin_rate)) +
  geom_point(aes(color=playerid)) +
  geom_smooth() + 
  theme(legend.position = "none")
```

![](2-dplyr_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---

## Another Solution (interactive edition)


```r
library(rbokeh)
 pitch %&gt;%
  filter(spin_rate &gt;= 3200 &amp; pitcher_hand == "L") %&gt;%
  figure() %&gt;%
  ly_points(x = action_result, y = spin_rate, color = playerid, hover = list(playerid, spin_rate, action_result), legend = FALSE) 
```

<div id="htmlwidget-f1cb5cb742ba2facfca6" style="width:504px;height:216px;" class="rbokeh html-widget"></div>
<script type="application/json" data-for="htmlwidget-f1cb5cb742ba2facfca6">{"x":{"elementid":"2c222d3aee51bb3e4a5af22ab7125d82","modeltype":"Plot","modelid":"9af5cefc39720f799b16402c1ae3c1c7","docid":"75d8baa30050cdf0ecbb4ccf6a8f1d5a","docs_json":{"75d8baa30050cdf0ecbb4ccf6a8f1d5a":{"version":"0.12.5","title":"Bokeh Figure","roots":{"root_ids":["9af5cefc39720f799b16402c1ae3c1c7"],"references":[{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","attributes":{"id":"9af5cefc39720f799b16402c1ae3c1c7","sizing_mode":"scale_both","x_range":{"type":"FactorRange","id":"a4ad705186ed75e7fdf633e0a97830c2"},"y_range":{"type":"Range1d","id":"c032d6428403c97ef84bdf4b275d0b81"},"left":[{"type":"LinearAxis","id":"d98713b9baa407a5c6346ec66053008d"}],"below":[{"type":"CategoricalAxis","id":"2528c2cff9edbc2a4b98fb791e2a6032"}],"right":[],"above":[],"renderers":[{"type":"BoxAnnotation","id":"13baaa0cc8ebd61daa9dcc30e06033be"},{"type":"GlyphRenderer","id":"3dce5ddfb03bc57ff90c63986eb23197"},{"type":"CategoricalAxis","id":"2528c2cff9edbc2a4b98fb791e2a6032"},{"type":"Grid","id":"648984d886582feeee8717df71c62091"},{"type":"LinearAxis","id":"d98713b9baa407a5c6346ec66053008d"},{"type":"Grid","id":"a177d0f250f5f0f295be99701b31b54b"}],"extra_y_ranges":{},"extra_x_ranges":{},"tags":[],"min_border_left":4,"min_border_right":4,"min_border_top":4,"min_border_bottom":4,"lod_threshold":null,"toolbar":{"type":"Toolbar","id":"672d741b6dba9f480d3efa1435d68808"},"tool_events":{"type":"ToolEvents","id":"6aa55f77cd432ebda6988be7fbe008c5"}},"subtype":"Figure"},{"type":"Toolbar","id":"672d741b6dba9f480d3efa1435d68808","attributes":{"id":"672d741b6dba9f480d3efa1435d68808","tags":[],"active_drag":"auto","active_scroll":"auto","active_tap":"auto","tools":[{"type":"PanTool","id":"11650f7e54f484caf96d8a778598df18"},{"type":"WheelZoomTool","id":"5fe14fd4b0be76916d632427aadd6ff5"},{"type":"BoxZoomTool","id":"44603f57a0ef08b11f03a6e9cfb643ff"},{"type":"ResetTool","id":"17c25dfa7728d112d8fe3acb22d30b79"},{"type":"SaveTool","id":"df0a735ae0fc0a95ed8129e04c1268b5"},{"type":"HelpTool","id":"bf98db5838dffdce65de53f7e347c996"},{"type":"HoverTool","id":"2553877ba648a9a67dedab9b266a87d9"}],"logo":null}},{"type":"PanTool","id":"11650f7e54f484caf96d8a778598df18","attributes":{"id":"11650f7e54f484caf96d8a778598df18","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"dimensions":"both"}},{"type":"ToolEvents","id":"6aa55f77cd432ebda6988be7fbe008c5","attributes":{"id":"6aa55f77cd432ebda6988be7fbe008c5","tags":[]},"geometries":[]},{"type":"WheelZoomTool","id":"5fe14fd4b0be76916d632427aadd6ff5","attributes":{"id":"5fe14fd4b0be76916d632427aadd6ff5","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"dimensions":"both"}},{"type":"BoxAnnotation","id":"13baaa0cc8ebd61daa9dcc30e06033be","attributes":{"id":"13baaa0cc8ebd61daa9dcc30e06033be","tags":[],"line_color":{"units":"data","value":"black"},"line_alpha":{"units":"data","value":1},"fill_color":{"units":"data","value":"lightgrey"},"fill_alpha":{"units":"data","value":0.5},"line_dash":[4,4],"line_width":{"units":"data","value":2},"level":"overlay","top_units":"screen","bottom_units":"screen","left_units":"screen","right_units":"screen","render_mode":"css"}},{"type":"BoxZoomTool","id":"44603f57a0ef08b11f03a6e9cfb643ff","attributes":{"id":"44603f57a0ef08b11f03a6e9cfb643ff","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"overlay":{"type":"BoxAnnotation","id":"13baaa0cc8ebd61daa9dcc30e06033be"}}},{"type":"ResetTool","id":"17c25dfa7728d112d8fe3acb22d30b79","attributes":{"id":"17c25dfa7728d112d8fe3acb22d30b79","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"}}},{"type":"SaveTool","id":"df0a735ae0fc0a95ed8129e04c1268b5","attributes":{"id":"df0a735ae0fc0a95ed8129e04c1268b5","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"}}},{"type":"HelpTool","id":"bf98db5838dffdce65de53f7e347c996","attributes":{"id":"bf98db5838dffdce65de53f7e347c996","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"redirect":"https://hafen.github.io/rbokeh/","help_tooltip":"Click to learn more about rbokeh."}},{"type":"HoverTool","id":"2553877ba648a9a67dedab9b266a87d9","attributes":{"id":"2553877ba648a9a67dedab9b266a87d9","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"renderers":[{"type":"GlyphRenderer","id":"3dce5ddfb03bc57ff90c63986eb23197"}],"names":[],"anchor":"center","attachment":"horizontal","line_policy":"prev","mode":"mouse","point_policy":"snap_to_data","tooltips":[["playerid","@hover_col_1"],["spin_rate","@hover_col_2"],["action_result","@hover_col_3"]]}},{"type":"ColumnDataSource","id":"5d0b4d9a7e237b971f78c10630bf9e38","attributes":{"id":"5d0b4d9a7e237b971f78c10630bf9e38","tags":[],"column_names":["x","y","line_color","fill_color","hover_col_1","hover_col_2","hover_col_3"],"selected":[],"data":{"x":["B","B","S","F","B","F","B","B","B"],"y":[3286.313,3248.3821,3203.5969,3237.7629,3278.4861,3237.9861,3226.5071,3206.4629,3264.386],"line_color":["#238B45","#0B7734","#0B7734","#0B7734","#66C2A4","#37A265","#37A265","#00441B","#00441B"],"fill_color":["#238B45","#0B7734","#0B7734","#0B7734","#66C2A4","#37A265","#37A265","#00441B","#00441B"],"hover_col_1":[" 7291"," 8247"," 8247"," 8247","  607"," 4629"," 4629","13586","13586"],"hover_col_2":["3286.313","3248.382","3203.597","3237.763","3278.486","3237.986","3226.507","3206.463","3264.386"],"hover_col_3":["B","B","S","F","B","F","B","B","B"]}}},{"type":"Circle","id":"7f72765904e67b30632f7da842d7fe50","attributes":{"id":"7f72765904e67b30632f7da842d7fe50","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"Circle","id":"e1290ef36a055fa315061042ee79e9fb","attributes":{"id":"e1290ef36a055fa315061042ee79e9fb","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","value":"#e1e1e1"},"fill_color":{"units":"data","value":"#e1e1e1"}}},{"type":"Circle","id":"40e47d22a8e27c11a73f1e7cbc5fb9af","attributes":{"id":"40e47d22a8e27c11a73f1e7cbc5fb9af","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":1},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"GlyphRenderer","id":"3dce5ddfb03bc57ff90c63986eb23197","attributes":{"id":"3dce5ddfb03bc57ff90c63986eb23197","tags":[],"selection_glyph":null,"nonselection_glyph":{"type":"Circle","id":"e1290ef36a055fa315061042ee79e9fb"},"hover_glyph":{"type":"Circle","id":"40e47d22a8e27c11a73f1e7cbc5fb9af"},"name":null,"data_source":{"type":"ColumnDataSource","id":"5d0b4d9a7e237b971f78c10630bf9e38"},"glyph":{"type":"Circle","id":"7f72765904e67b30632f7da842d7fe50"}}},{"type":"FactorRange","id":"a4ad705186ed75e7fdf633e0a97830c2","attributes":{"id":"a4ad705186ed75e7fdf633e0a97830c2","tags":[],"factors":["B","F","S"]}},{"type":"Range1d","id":"c032d6428403c97ef84bdf4b275d0b81","attributes":{"id":"c032d6428403c97ef84bdf4b275d0b81","tags":[],"start":3197.806773,"end":3292.103127}},{"type":"CategoricalAxis","id":"2528c2cff9edbc2a4b98fb791e2a6032","attributes":{"id":"2528c2cff9edbc2a4b98fb791e2a6032","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"axis_label":"action_result","formatter":{"type":"CategoricalTickFormatter","id":"5e04dcae64d7408abe0580667a9e6c58"},"ticker":{"type":"CategoricalTicker","id":"bd18f64005c3e0e9c07a40728f2233bd"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"CategoricalTickFormatter","id":"5e04dcae64d7408abe0580667a9e6c58","attributes":{"id":"5e04dcae64d7408abe0580667a9e6c58","tags":[]}},{"type":"CategoricalTicker","id":"bd18f64005c3e0e9c07a40728f2233bd","attributes":{"id":"bd18f64005c3e0e9c07a40728f2233bd","tags":[]}},{"type":"Grid","id":"648984d886582feeee8717df71c62091","attributes":{"id":"648984d886582feeee8717df71c62091","tags":[],"dimension":0,"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"ticker":{"type":"CategoricalTicker","id":"bd18f64005c3e0e9c07a40728f2233bd"}}},{"type":"LinearAxis","id":"d98713b9baa407a5c6346ec66053008d","attributes":{"id":"d98713b9baa407a5c6346ec66053008d","tags":[],"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"axis_label":"spin_rate","formatter":{"type":"BasicTickFormatter","id":"9d56bfa6a0ccf69bffad8ef5347f2b47"},"ticker":{"type":"BasicTicker","id":"96fce86c9fc61a9fef20a5b1abccbf3a"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"BasicTickFormatter","id":"9d56bfa6a0ccf69bffad8ef5347f2b47","attributes":{"id":"9d56bfa6a0ccf69bffad8ef5347f2b47","tags":[]}},{"type":"BasicTicker","id":"96fce86c9fc61a9fef20a5b1abccbf3a","attributes":{"id":"96fce86c9fc61a9fef20a5b1abccbf3a","tags":[],"num_minor_ticks":5}},{"type":"Grid","id":"a177d0f250f5f0f295be99701b31b54b","attributes":{"id":"a177d0f250f5f0f295be99701b31b54b","tags":[],"dimension":1,"plot":{"type":"Plot","id":"9af5cefc39720f799b16402c1ae3c1c7","subtype":"Figure"},"ticker":{"type":"BasicTicker","id":"96fce86c9fc61a9fef20a5b1abccbf3a"}}}]}}},"debug":false},"evals":[],"jsHooks":[]}</script>

---


## Arrange
 -Easy way to arrange your data in ascending or descending order

```r
pitch %&gt;% 
  subset(select = c("playerid", "spin_rate")) %&gt;%
  arrange(desc(playerid), spin_rate) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   playerid spin_rate
##      &lt;dbl&gt;     &lt;dbl&gt;
## 1    24121     2147.
## 2    24121     2294.
## 3    24121     2300.
## 4    24121     2309.
## 5    24121     2317.
```

Successive variables are used for breaking ties from previous variables.


```r
pitch %&gt;% 
  subset(select = c("playerid", "spin_rate")) %&gt;%
  arrange(playerid, spin_rate) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   playerid spin_rate
##      &lt;dbl&gt;     &lt;dbl&gt;
## 1      476     1961.
## 2      476     2098.
## 3      476     2148.
## 4      476     2179.
## 5      476     2181.
```

---
class: inverse

## Your Turn (5 min)

1. Look up the help file for the function `slice`.

2. Use `slice` on the arranged `pitchdata` dataset to select a single row

3. use `slice` to select multiple rows

Hint: Use the entire data set

---

## Solution


```r
pitch %&gt;% 
  arrange(desc(playerid), spin_rate) %&gt;% 
  slice(11)
```

```
## # A tibble: 1 × 31
##   playerid batter_stand pitcher_hand prev_pitch_type prev_start_speed prev_px
##      &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;  
## 1    24121 R            L            "\\N"           "\\N"            "\\N"  
## # … with 25 more variables: prev_pz &lt;chr&gt;, pitch_type &lt;chr&gt;, px &lt;dbl&gt;,
## #   pz &lt;dbl&gt;, start_speed &lt;dbl&gt;, x0 &lt;dbl&gt;, y0 &lt;dbl&gt;, z0 &lt;dbl&gt;, vx0 &lt;dbl&gt;,
## #   vy0 &lt;dbl&gt;, vz0 &lt;dbl&gt;, ax &lt;dbl&gt;, ay &lt;dbl&gt;, az &lt;dbl&gt;, exit_velocity &lt;dbl&gt;,
## #   pfx_x &lt;dbl&gt;, pfx_z &lt;dbl&gt;, spin_dir &lt;dbl&gt;, spin_rate &lt;dbl&gt;, ball &lt;dbl&gt;,
## #   strike &lt;dbl&gt;, action_result &lt;chr&gt;, ab_result &lt;chr&gt;, adj_h &lt;dbl&gt;,
## #   adj_tb &lt;dbl&gt;
```


```r
pitch %&gt;% 
  arrange(desc(playerid), spin_rate) %&gt;% 
  slice(1:5)
```

```
## # A tibble: 5 × 31
##   playerid batter_stand pitcher_hand prev_pitch_type prev_start_speed prev_px
##      &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;  
## 1    24121 R            L            "\\N"           "\\N"            "\\N"  
## 2    24121 R            L            "\\N"           "\\N"            "\\N"  
## 3    24121 R            L            "\\N"           "\\N"            "\\N"  
## 4    24121 R            L            "CU"            "72.04"          "1.500"
## 5    24121 R            L            "\\N"           "\\N"            "\\N"  
## # … with 25 more variables: prev_pz &lt;chr&gt;, pitch_type &lt;chr&gt;, px &lt;dbl&gt;,
## #   pz &lt;dbl&gt;, start_speed &lt;dbl&gt;, x0 &lt;dbl&gt;, y0 &lt;dbl&gt;, z0 &lt;dbl&gt;, vx0 &lt;dbl&gt;,
## #   vy0 &lt;dbl&gt;, vz0 &lt;dbl&gt;, ax &lt;dbl&gt;, ay &lt;dbl&gt;, az &lt;dbl&gt;, exit_velocity &lt;dbl&gt;,
## #   pfx_x &lt;dbl&gt;, pfx_z &lt;dbl&gt;, spin_dir &lt;dbl&gt;, spin_rate &lt;dbl&gt;, ball &lt;dbl&gt;,
## #   strike &lt;dbl&gt;, action_result &lt;chr&gt;, ab_result &lt;chr&gt;, adj_h &lt;dbl&gt;,
## #   adj_tb &lt;dbl&gt;
```

---

## Select
 - Using Select we are easily able to create a subset of our data. This is similar to
 the subset function in base.

```r
pitch %&gt;% 
  select(playerid, pitcher_hand, action_result, ab_result, spin_dir, spin_rate) %&gt;%
  head()
```

```
## # A tibble: 6 × 6
##   playerid pitcher_hand action_result ab_result spin_dir spin_rate
##      &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;         &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
## 1     3103 R            B             "\\N"        182.      1140.
## 2     3103 R            X             "O"          196.      1098.
## 3     2309 R            F             "\\N"         31.0     1573.
## 4     2028 R            F             "\\N"         90.5     1540.
## 5     3183 R            C             "\\N"        176.      1222.
## 6     3183 R            B             "\\N"        179.      1220.
```

---

## Summarise
 - Finding summary statistics of a metric

```r
pitch %&gt;%
    summarise(mean_spinrate = mean(spin_rate, na.rm=TRUE), 
              sd_spinrate = sd(spin_rate, na.rm = TRUE))
```

```
## # A tibble: 1 × 2
##   mean_spinrate sd_spinrate
##           &lt;dbl&gt;       &lt;dbl&gt;
## 1         2537.        306.
```

---

## Summarise and Group_by
 - Finding summary statistics of a metric after accounting first for other variables

```r
pitch %&gt;%
    group_by(playerid) %&gt;%
    summarise(mean_spinrate = mean(spin_rate, na.rm=TRUE), 
              sd_spinrate = sd(spin_rate, na.rm = TRUE))
```

```
## # A tibble: 383 × 3
##    playerid mean_spinrate sd_spinrate
##       &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1      476         2726.       161. 
##  2      485         2434.       155. 
##  3      517         2543.        92.3
##  4      607         1986.       283. 
##  5      645         2473.        77.9
##  6      646         2132.       145. 
##  7      657         2817.       103. 
##  8      702         1782.       426. 
##  9      721         2352.        70.3
## 10      843         2222.       151. 
## # … with 373 more rows
```

---
class: inverse

## Your Turn (5 minutes)

1. Select only playerid, spin_rate, and action result

2. Group by both playerid and action result and find mean and sd of spin rates 

3.`%&gt;%` the summaries into a `ggplot` histogram

---

## A Solution


```r
pitch %&gt;%
  select(playerid, spin_rate, action_result) %&gt;%
    group_by(playerid, action_result) %&gt;%
    summarise(mean_spin = mean(spin_rate), sd_spin = sd(spin_rate)) %&gt;%
  ggplot(aes(x = mean_spin)) + geom_histogram()
```

![](2-dplyr_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---

## Mutate

 -Change an existing or create a new variable into the data
 -Creating a new column in your data set that represents something new
 -Great for calculations 
 -How would I create a calculation for how far above or below each players pitches are from their own average spin rates?

```r
pitch %&gt;%
    select(playerid, spin_rate, action_result) %&gt;%
    group_by(playerid, action_result) %&gt;%
    summarise(mean_spin = mean(spin_rate), sd_spin = sd(spin_rate)) %&gt;%
    mutate(mean = sum(mean_spin) / n()) %&gt;%
    mutate(difference = mean - mean_spin)
```

```
## `summarise()` has grouped output by 'playerid'. You can override using the `.groups` argument.
```

```
## # A tibble: 1,662 × 6
## # Groups:   playerid [383]
##    playerid action_result mean_spin sd_spin  mean difference
##       &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1      476 B                 2739.    161. 2728.     -10.8 
##  2      476 C                 2699.    147. 2728.      29.4 
##  3      476 F                 2733.    174. 2728.      -4.35
##  4      476 S                 2754.    199. 2728.     -25.5 
##  5      476 X                 2717.    140. 2728.      11.3 
##  6      485 B                 2415.    188. 2438.      23.6 
##  7      485 C                 2460.    111. 2438.     -22.2 
##  8      485 F                 2462.    125. 2438.     -23.5 
##  9      485 S                 2434.    145. 2438.       4.25
## 10      485 X                 2421.    155. 2438.      17.8 
## # … with 1,652 more rows
```

---

## Caution: Be careful about using the newly created variable outside of a chunk

Why does 


```r
pitch$mean_spin
```

```
## Warning: Unknown or uninitialised column: `mean_spin`.
```

```
## NULL
```

not return a real-valued summary?

--

- We only ever look at this new variable in the previous chunk.
- It has not been created globally into the dataset itself


---
- To do this, you need to create your new column by declaring it as its own variable.

```r
pitch$mean_spin &lt;- mean(pitch$spin_rate)
```


---

## `mutate` OR `summarize`?

Both commands introduce new variables - so which one should we use?

.pull-left[
`mutate` 

- **adds variables** to the existing data set

- The resulting variables must have the **same length** as the original data

- e.g. use for transformations, combinations of multiple variables

]

.pull-right[
`summarize` 

- **creates aggregates** of the original data

- The number of rows of the new dataset is determined by the number of combinations of the grouping structure. 

- The number of columns is determined by the number of grouping variables and the summary statistics.
]

---

## Shortcuts


`summarize(n = n())` is equivalent to `tally()` 


```r
pitch %&gt;% tally()
pitch %&gt;% summarize(n=n())
```


`group_by(time, subject) %&gt;% summarize(n = n())` is equivalent to `count(time, subject)`


```r
pitch %&gt;% count(playerid, action_result)
pitch %&gt;% group_by(playerid, action_result) %&gt;% summarize(n=n())
```
---
class: inverse
## Your Turn (10 min) 


Based on your (limited) knowledge of baseball, you determine what is a "successful" curveball.
Then determine what pitchers pitched the most successful curveballs! If time allows create a visual that shows the top 5 pitchers who threw the most successful curveballs

Note: There are many different ways of answering this question. None are wrong and you don't need to know anything about baseball to try. Consider criteria that it needs to meet. Ex. A successful curveball needs to be above 90 mph in velocity and have over 2800 rpms in spin rate.
---

## One Solution


```r
SScurve &lt;- pitch %&gt;%
  select("playerid", "action_result", "ab_result", "adj_h") %&gt;%  
  arrange(desc(playerid)) %&gt;% mutate(successfulCU = ifelse(
    (adj_h &lt; .3 &amp; ab_result != "\\N" ) | 
      (action_result %in% c("C","S","F")), 1, 0)) %&gt;%
#Consider a success any strike and any batted ball resulting in a 
#adj_h less than the league average of .300 BABIP (according to MLB.com).
  group_by(playerid) %&gt;% mutate(totalSSCU=sum(successfulCU)) %&gt;% 
  mutate(percentSSCU=totalSSCU / n())
SScurve
```

```
## # A tibble: 42,158 × 7
## # Groups:   playerid [383]
##    playerid action_result ab_result adj_h successfulCU totalSSCU percentSSCU
##       &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1    24121 B             "\\N"         0            0       159       0.528
##  2    24121 C             "\\N"         0            1       159       0.528
##  3    24121 C             "\\N"         0            1       159       0.528
##  4    24121 B             "\\N"         0            0       159       0.528
##  5    24121 C             "\\N"         0            1       159       0.528
##  6    24121 C             "\\N"         0            1       159       0.528
##  7    24121 B             "\\N"         0            0       159       0.528
##  8    24121 B             "\\N"         0            0       159       0.528
##  9    24121 B             "\\N"         0            0       159       0.528
## 10    24121 C             "\\N"         0            1       159       0.528
## # … with 42,148 more rows
```

---
## Solution (Cont)

```r
#Calculate successful curveball percentages
percentages &lt;- distinct(.data = SScurve, playerid, totalSSCU, percentSSCU)
#Look at some graphs to see what the data actually looks like now. 
library(rbokeh)
library(quanteda)
ggplot(data = percentages) + geom_point(aes(x = percentSSCU, y = totalSSCU, 
                                            colour = playerid))
```

![](2-dplyr_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

## Solution (Cont.)

```r
#Filter down to get the best pitchers with a minimum of 127 curveballs thrown 
#(our median)
qualifiedPercentages &lt;- percentages %&gt;% filter(totalSSCU &gt; 127) %&gt;% 
  arrange(desc(percentSSCU))
figure() %&gt;%
  ly_points(x = percentSSCU, y = totalSSCU, color = playerid,
            data = qualifiedPercentages, hover = list(playerid, totalSSCU, 
                                                      percentSSCU), 
            legend = FALSE)
```

<div id="htmlwidget-e2d1d8bfed8ad144db1d" style="width:504px;height:216px;" class="rbokeh html-widget"></div>
<script type="application/json" data-for="htmlwidget-e2d1d8bfed8ad144db1d">{"x":{"elementid":"2755128b6fef99d4eda7782001ae085b","modeltype":"Plot","modelid":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","docid":"6acb258f9f329d5296af9f6fe4d6a92d","docs_json":{"6acb258f9f329d5296af9f6fe4d6a92d":{"version":"0.12.5","title":"Bokeh Figure","roots":{"root_ids":["ccd7cb80b7c6f91fe6e10e3d98f6c29a"],"references":[{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","attributes":{"id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","sizing_mode":"scale_both","x_range":{"type":"Range1d","id":"221bddf32b9f044071d234f61aa232ca"},"y_range":{"type":"Range1d","id":"4de53dc2c104583cca6e32f9f7d46135"},"left":[{"type":"LinearAxis","id":"c4a256b758d3226207ace6f330745b7a"}],"below":[{"type":"LinearAxis","id":"308486cb1bfa682b4bfd0d9537171add"}],"right":[],"above":[],"renderers":[{"type":"BoxAnnotation","id":"8dbde3c485f3fd18795ad6d8b4248ce5"},{"type":"GlyphRenderer","id":"255869c937efb66d3a2fcadec71110a2"},{"type":"LinearAxis","id":"308486cb1bfa682b4bfd0d9537171add"},{"type":"Grid","id":"04b91869b424bd732d9329e2e47f1996"},{"type":"LinearAxis","id":"c4a256b758d3226207ace6f330745b7a"},{"type":"Grid","id":"baccd02455b8cb35e0ca461d70d843c3"}],"extra_y_ranges":{},"extra_x_ranges":{},"tags":[],"min_border_left":4,"min_border_right":4,"min_border_top":4,"min_border_bottom":4,"lod_threshold":null,"toolbar":{"type":"Toolbar","id":"2ea2c8f968398b91fc84c983c018c32f"},"tool_events":{"type":"ToolEvents","id":"2e551ea8739aa796ec80ce848e4f37e1"}},"subtype":"Figure"},{"type":"Toolbar","id":"2ea2c8f968398b91fc84c983c018c32f","attributes":{"id":"2ea2c8f968398b91fc84c983c018c32f","tags":[],"active_drag":"auto","active_scroll":"auto","active_tap":"auto","tools":[{"type":"PanTool","id":"8128e99948eafe9f3439502b38cce58a"},{"type":"WheelZoomTool","id":"b23bd208c5e1d39f1857fbb1ee6eb560"},{"type":"BoxZoomTool","id":"8812a2ea1d65146c0ec5bd5bc60b09c8"},{"type":"ResetTool","id":"70e4faacfeb6f1f703a05445558aafc9"},{"type":"SaveTool","id":"2cde05e2f0c4d4b39c7325aad9495227"},{"type":"HelpTool","id":"af5818dc6a0313488ef433f9139ed8e1"},{"type":"HoverTool","id":"0c200e46f69794d5e7d7f5b36726492a"}],"logo":null}},{"type":"PanTool","id":"8128e99948eafe9f3439502b38cce58a","attributes":{"id":"8128e99948eafe9f3439502b38cce58a","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"dimensions":"both"}},{"type":"ToolEvents","id":"2e551ea8739aa796ec80ce848e4f37e1","attributes":{"id":"2e551ea8739aa796ec80ce848e4f37e1","tags":[]},"geometries":[]},{"type":"WheelZoomTool","id":"b23bd208c5e1d39f1857fbb1ee6eb560","attributes":{"id":"b23bd208c5e1d39f1857fbb1ee6eb560","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"dimensions":"both"}},{"type":"BoxAnnotation","id":"8dbde3c485f3fd18795ad6d8b4248ce5","attributes":{"id":"8dbde3c485f3fd18795ad6d8b4248ce5","tags":[],"line_color":{"units":"data","value":"black"},"line_alpha":{"units":"data","value":1},"fill_color":{"units":"data","value":"lightgrey"},"fill_alpha":{"units":"data","value":0.5},"line_dash":[4,4],"line_width":{"units":"data","value":2},"level":"overlay","top_units":"screen","bottom_units":"screen","left_units":"screen","right_units":"screen","render_mode":"css"}},{"type":"BoxZoomTool","id":"8812a2ea1d65146c0ec5bd5bc60b09c8","attributes":{"id":"8812a2ea1d65146c0ec5bd5bc60b09c8","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"overlay":{"type":"BoxAnnotation","id":"8dbde3c485f3fd18795ad6d8b4248ce5"}}},{"type":"ResetTool","id":"70e4faacfeb6f1f703a05445558aafc9","attributes":{"id":"70e4faacfeb6f1f703a05445558aafc9","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"}}},{"type":"SaveTool","id":"2cde05e2f0c4d4b39c7325aad9495227","attributes":{"id":"2cde05e2f0c4d4b39c7325aad9495227","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"}}},{"type":"HelpTool","id":"af5818dc6a0313488ef433f9139ed8e1","attributes":{"id":"af5818dc6a0313488ef433f9139ed8e1","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"redirect":"https://hafen.github.io/rbokeh/","help_tooltip":"Click to learn more about rbokeh."}},{"type":"HoverTool","id":"0c200e46f69794d5e7d7f5b36726492a","attributes":{"id":"0c200e46f69794d5e7d7f5b36726492a","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"renderers":[{"type":"GlyphRenderer","id":"255869c937efb66d3a2fcadec71110a2"}],"names":[],"anchor":"center","attachment":"horizontal","line_policy":"prev","mode":"mouse","point_policy":"snap_to_data","tooltips":[["playerid","@hover_col_1"],["totalSSCU","@hover_col_2"],["percentSSCU","@hover_col_3"]]}},{"type":"ColumnDataSource","id":"358062aa27dff891c70a94f0e478841f","attributes":{"id":"358062aa27dff891c70a94f0e478841f","tags":[],"column_names":["x","y","line_color","fill_color","hover_col_1","hover_col_2","hover_col_3"],"selected":[],"data":{"x":[0.693333333333333,0.668161434977579,0.652027027027027,0.639130434782609,0.635179153094462,0.634297520661157,0.625641025641026,0.620224719101124,0.618046971569839,0.617021276595745,0.616797900262467,0.609218436873748,0.607758620689655,0.607558139534884,0.606896551724138,0.601910828025478,0.599749058971142,0.595317725752508,0.593220338983051,0.591011235955056,0.585751978891821,0.584558823529412,0.579185520361991,0.577319587628866,0.576335877862595,0.570332480818414,0.56969696969697,0.5696,0.566091954022989,0.564377682403433,0.561111111111111,0.557213930348259,0.553719008264463,0.553086419753086,0.549909255898367,0.548571428571429,0.548254620123203,0.546268656716418,0.54040404040404,0.533864541832669,0.529230769230769,0.528239202657807,0.524752475247525,0.522448979591837,0.512626262626263,0.510869565217391,0.507042253521127,0.50561797752809,0.471976401179941],"y":[156,149,193,441,195,307,244,276,500,377,235,304,141,209,352,189,478,178,175,263,222,159,128,168,151,223,188,356,197,263,202,224,134,224,303,192,267,183,214,134,172,159,159,128,203,141,144,225,160],"line_color":["#66C2A4","#66C2A4","#66C2A4","#238B45","#66C2A4","#41AE76","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#41AE76","#006D2C","#66C2A4","#41AE76","#66C2A4","#41AE76","#66C2A4","#66C2A4","#66C2A4","#41AE76","#238B45","#41AE76","#006D2C","#66C2A4","#41AE76","#238B45","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#41AE76","#66C2A4","#66C2A4","#41AE76","#41AE76","#238B45","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#00441B","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4"],"fill_color":["#66C2A4","#66C2A4","#66C2A4","#238B45","#66C2A4","#41AE76","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#41AE76","#006D2C","#66C2A4","#41AE76","#66C2A4","#41AE76","#66C2A4","#66C2A4","#66C2A4","#41AE76","#238B45","#41AE76","#006D2C","#66C2A4","#41AE76","#238B45","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#41AE76","#66C2A4","#66C2A4","#41AE76","#41AE76","#238B45","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#00441B","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4","#66C2A4"],"hover_col_1":[" 3730","  645","  485","10060"," 4378"," 5666","  959"," 3229"," 1030"," 3394"," 4478"," 6803","16448"," 4787"," 5070"," 1828"," 5972"," 4322"," 4482"," 1815"," 6205","13586"," 8347","16762"," 3467"," 6822","11683"," 3411"," 3062"," 3802"," 2653"," 9410"," 3680"," 3138"," 8247"," 8288","14344","  657"," 3211"," 1151"," 3733","24121"," 3646"," 3282"," 4198"," 2295"," 4208"," 2108"," 1711"],"hover_col_2":["156","149","193","441","195","307","244","276","500","377","235","304","141","209","352","189","478","178","175","263","222","159","128","168","151","223","188","356","197","263","202","224","134","224","303","192","267","183","214","134","172","159","159","128","203","141","144","225","160"],"hover_col_3":["0.6933333","0.6681614","0.6520270","0.6391304","0.6351792","0.6342975","0.6256410","0.6202247","0.6180470","0.6170213","0.6167979","0.6092184","0.6077586","0.6075581","0.6068966","0.6019108","0.5997491","0.5953177","0.5932203","0.5910112","0.5857520","0.5845588","0.5791855","0.5773196","0.5763359","0.5703325","0.5696970","0.5696000","0.5660920","0.5643777","0.5611111","0.5572139","0.5537190","0.5530864","0.5499093","0.5485714","0.5482546","0.5462687","0.5404040","0.5338645","0.5292308","0.5282392","0.5247525","0.5224490","0.5126263","0.5108696","0.5070423","0.5056180","0.4719764"]}}},{"type":"Circle","id":"878d3a5640c43d7f32a3ace6ac8b256d","attributes":{"id":"878d3a5640c43d7f32a3ace6ac8b256d","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"Circle","id":"af21f280b1b3a625618b7c1f74f88424","attributes":{"id":"af21f280b1b3a625618b7c1f74f88424","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","value":"#e1e1e1"},"fill_color":{"units":"data","value":"#e1e1e1"}}},{"type":"Circle","id":"862d75180aa267c37cd6c6a85b7ce300","attributes":{"id":"862d75180aa267c37cd6c6a85b7ce300","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":1},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"GlyphRenderer","id":"255869c937efb66d3a2fcadec71110a2","attributes":{"id":"255869c937efb66d3a2fcadec71110a2","tags":[],"selection_glyph":null,"nonselection_glyph":{"type":"Circle","id":"af21f280b1b3a625618b7c1f74f88424"},"hover_glyph":{"type":"Circle","id":"862d75180aa267c37cd6c6a85b7ce300"},"name":null,"data_source":{"type":"ColumnDataSource","id":"358062aa27dff891c70a94f0e478841f"},"glyph":{"type":"Circle","id":"878d3a5640c43d7f32a3ace6ac8b256d"}}},{"type":"Range1d","id":"221bddf32b9f044071d234f61aa232ca","attributes":{"id":"221bddf32b9f044071d234f61aa232ca","tags":[],"start":0.456481415929204,"end":0.708828318584071}},{"type":"Range1d","id":"4de53dc2c104583cca6e32f9f7d46135","attributes":{"id":"4de53dc2c104583cca6e32f9f7d46135","tags":[],"start":101.96,"end":526.04}},{"type":"LinearAxis","id":"308486cb1bfa682b4bfd0d9537171add","attributes":{"id":"308486cb1bfa682b4bfd0d9537171add","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"axis_label":"percentSSCU","formatter":{"type":"BasicTickFormatter","id":"abf45c1e67071eed33be545d2e4c4e1d"},"ticker":{"type":"BasicTicker","id":"52159d1dfb20108536d37703d8ab172a"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"BasicTickFormatter","id":"abf45c1e67071eed33be545d2e4c4e1d","attributes":{"id":"abf45c1e67071eed33be545d2e4c4e1d","tags":[]}},{"type":"BasicTicker","id":"52159d1dfb20108536d37703d8ab172a","attributes":{"id":"52159d1dfb20108536d37703d8ab172a","tags":[],"num_minor_ticks":5}},{"type":"Grid","id":"04b91869b424bd732d9329e2e47f1996","attributes":{"id":"04b91869b424bd732d9329e2e47f1996","tags":[],"dimension":0,"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"ticker":{"type":"BasicTicker","id":"52159d1dfb20108536d37703d8ab172a"}}},{"type":"LinearAxis","id":"c4a256b758d3226207ace6f330745b7a","attributes":{"id":"c4a256b758d3226207ace6f330745b7a","tags":[],"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"axis_label":"totalSSCU","formatter":{"type":"BasicTickFormatter","id":"f381c495ad093779e8532a76f634f20f"},"ticker":{"type":"BasicTicker","id":"2e849e5c6f0db8bf5fc99c96e8f71424"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"BasicTickFormatter","id":"f381c495ad093779e8532a76f634f20f","attributes":{"id":"f381c495ad093779e8532a76f634f20f","tags":[]}},{"type":"BasicTicker","id":"2e849e5c6f0db8bf5fc99c96e8f71424","attributes":{"id":"2e849e5c6f0db8bf5fc99c96e8f71424","tags":[],"num_minor_ticks":5}},{"type":"Grid","id":"baccd02455b8cb35e0ca461d70d843c3","attributes":{"id":"baccd02455b8cb35e0ca461d70d843c3","tags":[],"dimension":1,"plot":{"type":"Plot","id":"ccd7cb80b7c6f91fe6e10e3d98f6c29a","subtype":"Figure"},"ticker":{"type":"BasicTicker","id":"2e849e5c6f0db8bf5fc99c96e8f71424"}}}]}}},"debug":false},"evals":[],"jsHooks":[]}</script>



---
class: inverse

##  Your Turn (10 min)

The dataset `ChickWeight` is part of the core packages that come with R 

**Hint**: `data(ChickWeight)` gets the data into your active session.

From the help file:

&gt; four groups of chicks on different protein diets. The body weights of the chicks were measured at birth and every second day thereafter until day 20. They were also measured on day 21.

![](http://www.kenaifeed.com/wp-content/uploads/2015/03/chicks.jpg)

---
class: inverse

## Your Turn (10 min)

1. Create a line plot with each line representing the weight of each Chick 

2. Focus on weight on day 21. Draw side-by-side dotplots of weight by diet. 

3. **Bonus**: Use `summarize` the average weight on day 21 under each diet. Overlay the dotplots by error bars around the average weight under each diet (see `?geom_errorbar`)

**Hint** for 1: check out `?group` and consider what varible or variables you might map to this option

---

##  Solution - Q1


```r
ChickWeight %&gt;% 
  ggplot(aes(x=Time, y=weight, group=Chick, color=Diet)) +
  geom_line() + 
  facet_wrap(~Diet)
```

![](2-dplyr_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;

---

##  Solution - Q2


```r
ChickWeight %&gt;%   
  filter(Time==21) %&gt;% 
  ggplot(aes(x=Diet)) +
  geom_point(aes(y=weight, color=Diet), size=3)
```

![](2-dplyr_files/figure-html/unnamed-chunk-20-1.png)&lt;!-- --&gt;

---

##  Solution - Q3 

First, we need a separate dataset for the summary statistics:


```r
ChickW1 &lt;- ChickWeight %&gt;% 
  filter(Time==21) %&gt;% 
  group_by(Diet) %&gt;% 
  summarize(mean_weight = mean(weight, na.rm=TRUE),
            sd_weight = sd(weight, na.rm=TRUE)/n())
```

---

##  Solution - Q3 (cont)


```r
ChickWeight %&gt;% 
  filter(Time==21) %&gt;% 
  ggplot(aes(x=Diet)) +
  geom_point(aes(y=weight), size=2) +
  geom_errorbar(data= ChickW1, aes(ymin = mean_weight-1.96*sd_weight, ymax = mean_weight+1.96*sd_weight, colour = Diet), width=.3) +
  geom_point(data=ChickW1, aes(y=mean_weight, color=Diet), size=3)
```

![](2-dplyr_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;

---

## `Mutate` is incredibly flexible

Consider a new variable `gain`, which gives the increase in weight of a chick since birth


```r
ChickPlus &lt;- ChickWeight %&gt;% 
  group_by(Chick) %&gt;% 
  mutate(gain = weight - weight[Time == 0])
```





```
## Rows: 12
## Columns: 3
## $ weight &lt;dbl&gt; 42, 51, 59, 64, 76, 93, 106, 125, 149, 171, 199, 205
## $ Time   &lt;dbl&gt; 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 21
## $ gain   &lt;dbl&gt; 0, 9, 17, 22, 34, 51, 64, 83, 107, 129, 157, 163
```

---

## Plotting weight gain


```r
ChickPlus %&gt;% 
  ggplot(aes(x = Time, y = gain, group = Chick)) + 
  geom_line(aes(color=Diet)) +
  facet_wrap(~Diet)
```

![](2-dplyr_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;

---

## Re-cap

- getting used to `dplyr` actions can take a bit of time and practice

- recognize keywords and match them to `dplyr` functions

- incorporate `dplyr` functions in your regular workflow - the long-term benefits are there, promise!




&lt;!-- ## Are replicates similar? --&gt;

&lt;!-- ```{r fig.width = 4.5, fig.height=4.5} --&gt;
&lt;!-- reps &lt;- french_fries %&gt;%  --&gt;
&lt;!--   group_by(time, subject, treatment) %&gt;% --&gt;
&lt;!--   summarise(potato_diff = diff(potato), --&gt;
&lt;!--             potato = mean(potato)) --&gt;

&lt;!-- reps --&gt;
&lt;!-- ``` --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Are replicates similar? (contd.) --&gt;

&lt;!-- ```{r fig.height=4, warning=FALSE} --&gt;
&lt;!-- reps %&gt;%  --&gt;
&lt;!--   ggplot(aes(x = potato, y = potato_diff, colour = as.numeric(time))) +  --&gt;
&lt;!--   facet_wrap(~subject) + --&gt;
&lt;!--   geom_hline(aes(yintercept=0)) + --&gt;
&lt;!--   geom_point()  --&gt;
&lt;!-- ``` --&gt;


&lt;!-- ## Another Solution  --&gt;
&lt;!-- For a numeric approach, we could compute means across subjects for each week and compare those values: --&gt;

&lt;!-- ```{r purl=FALSE} --&gt;
&lt;!-- ffm &lt;- french_fries %&gt;%  --&gt;
&lt;!--   group_by(time) %&gt;%  --&gt;
&lt;!--   summarise(potato = mean(potato,  na.rm=TRUE), --&gt;
&lt;!--             buttery = mean(buttery,  na.rm=TRUE), --&gt;
&lt;!--             painty = mean(painty,  na.rm=TRUE)) --&gt;

&lt;!-- ffm --&gt;
&lt;!-- ``` --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Another Solution (cont) --&gt;

&lt;!-- ```{r fig.height=3,  purl=FALSE} --&gt;

&lt;!-- ffm %&gt;% --&gt;
&lt;!--   ggplot(aes(x = time, y = potato)) +  --&gt;
&lt;!--   geom_point(colour = "blue", size=3) + --&gt;
&lt;!--   geom_point(aes(y = buttery), colour = "forestgreen", size=3) + --&gt;
&lt;!--   geom_point(aes(y = painty), colour = "red", size=3) + --&gt;
&lt;!--   ylab("Score") --&gt;
&lt;!-- ``` --&gt;

&lt;!-- This doesn't seem like an elegant or efficient way of answering the question: the data is in an awkward form! --&gt;

&lt;!-- --- --&gt;
&lt;!-- ## Another option --&gt;

&lt;!-- The package `GGally` has an implementation of a scatterplot matrix using ggplot2: --&gt;

&lt;!-- ```{r fig.height=4, warning=FALSE} --&gt;
&lt;!-- GGally::ggpairs(data = french_fries[ ,5:9]) --&gt;
&lt;!-- ``` --&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
