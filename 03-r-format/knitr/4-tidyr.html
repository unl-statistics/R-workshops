<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Wrangling</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.14/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Data Wrangling
]
.subtitle[
## Using tidyr
]

---




## What is tidy data?

 *Happy families are all alike; every unhappy family is unhappy in its own way. - Leo Tolstoy*  
&lt;br/&gt;

- Resource: follow along `tidyr` vignette 

- available as `vignette("tidy-data", package="tidyr")`

- vignette is version of the [tidy data paper](https://www.jstatsoft.org/article/view/v059i10) with updated code

---

## Outline

- Different sources of messiness

- Key-Value pairs

- `tidyr`: `pivot_wider` and `pivot_longer`, `separate`

---

## Data is usually in a spreadsheet format, but...

There are different ways of encoding the same information:

.pull-left[
**Option 1:**
&lt;style type="text/css"&gt;
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-s6z2{text-align:center}
.tg .tg-gmsq{background-color:#FCFBE3;font-style:italic;text-align:center}
.tg .tg-lyaj{background-color:#FCFBE3;text-align:center}
.tg .tg-hgcj{font-weight:bold;text-align:center}
&lt;/style&gt;
&lt;table class="tg"&gt;
  &lt;tr&gt;
    &lt;th class="tg-hgcj"&gt;Name&lt;/th&gt;
    &lt;th class="tg-hgcj"&gt;Treatment A&lt;/th&gt;
    &lt;th class="tg-hgcj"&gt;Treatment B&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-s6z2"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-gmsq"&gt;NA&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;18&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-s6z2"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-lyaj"&gt;4&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;1&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-s6z2"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-lyaj"&gt;6&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;7&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;


**Option 2:**

&lt;style type="text/css"&gt;
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}
.tg .tg-yq6s{background-color:#FCFBE3;text-align:center;vertical-align:top}
&lt;/style&gt;
&lt;table class="tg"&gt;
  &lt;tr&gt;
    &lt;th class="tg-amwm"&gt;Treatment&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;John Smith&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;Jane Doe&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;Mary Johnson&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-yq6s"&gt;A&lt;/td&gt;
    &lt;td class="tg-yq6s"&gt;NA&lt;/td&gt;
    &lt;td class="tg-yq6s"&gt;4&lt;/td&gt;
    &lt;td class="tg-yq6s"&gt;6&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;18&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;1&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;7&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
]
.pull-right[
**Option 3:**

&lt;style type="text/css"&gt;
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-s6z2{text-align:center}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-hgcj{font-weight:bold;text-align:center}
&lt;/style&gt;
&lt;table class="tg"&gt;
  &lt;tr&gt;
    &lt;th class="tg-hgcj"&gt;Name&lt;/th&gt;
    &lt;th class="tg-hgcj"&gt;Treatment&lt;/th&gt;
    &lt;th class="tg-hgcj"&gt;Measurement&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-s6z2"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;A&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;NA&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-s6z2"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;A&lt;/td&gt;
    &lt;td class="tg-s6z2"&gt;4&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;6&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;18&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;1&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;7&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
]

&lt;!--
Option #1

```
##           name treatmenta treatmentb
## 1   John Smith         NA         18
## 2     Jane Doe          4          1
## 3 Mary Johnson          6          7
```

Option #2

```
##   treatment John.Smith Jane.Doe Mary.Johnson
## 1         a         NA        4            6
## 2         b         18        1            7
```
--&gt;

Neither #1 nor #2 are "clean" versions of the data: observed information is part of the data structure; some implicit information is assumed

---

## Sources of Messiness (Review)


**Five main ways tables of data tend not to be tidy:**

1. Column headers are values, not variable names.

2. Multiple variables are stored in one column.

3. Variables are stored in both rows and columns.

4. Multiple types of observational units are stored in the same table.

5. A single observational unit is stored in multiple tables.


---

## What we have and what we want

.pull-left[
**Wide format**

- some variables are spread out across columns.

- typically uses less space to display

- how you would typically choose to present your data

- far less repetition of labels and row elements


![](images/tablewide2.png)

]
.pull-right[

**Long format**

- each variable is a column

- each observation is a row

- is likely not the data's most compact form


&lt;img src="4-tidyr_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

]

---
class: center, middle
## Remember from Graphics

.center[
![](images/tidydata.jpeg)
]

---

## Tidy Data

- Each variable is a column

- Each observation is a row

- Each type of observational unit forms a table

&lt;br/&gt;

&lt;style type="text/css"&gt;
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}
&lt;/style&gt;
&lt;table class="tg"&gt;
  &lt;tr&gt;
    &lt;th class="tg-amwm"&gt;Name&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;Treatment&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;Measurement&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;NA&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;18&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;4&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;1&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;6&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;7&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

---

## What makes data tidy?

.pull-left[
&lt;style type="text/css"&gt;
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}
&lt;/style&gt;
&lt;table class="tg"&gt;
  &lt;tr&gt;
    &lt;th class="tg-amwm"&gt;Name&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;Treatment&lt;/th&gt;
    &lt;th class="tg-amwm"&gt;Measurement&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;NA&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;John Smith&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;18&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;4&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Jane Doe&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;1&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;A&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;6&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class="tg-baqh"&gt;Mary Johnson&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;B&lt;/td&gt;
    &lt;td class="tg-baqh"&gt;7&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;

]

.pull-right[
- `treatment` and `patient` uniquely describe a single row in the dataset.

- `treatment` and `patient` are **key variables**,

- `score` is a **measurement variable**

- this makes `treatment-patient` and `score` a **key-value pair**

]


---

## Key-value pairs (KVP)
 
**Key-Value pairs** (KVP) - also *attribute-value*, *field-value*, *name-value*:
abstract data representation that allows a lot of flexibility  

One way of telling whether a data set is tidy is to check that all keys for a value are aligned in one row:


| &lt;img src="images/kvp-unhappy.png" width=150&gt; | &lt;img src="images/kvp-happy.png" width=150&gt;     | 
|Untidy data | Tidy data |

---

## Key-value pairs (KVP)

**Keys/Identifiers**:

- Identify a record (must be unique)

- Example: Indices on an random variable

- Fixed by design of experiment (known in advance)

- May be single or composite (may have one or more variables)

**Values/Measures**:

- Collected during the experiment (not known in advance)

- Usually numeric quantities

---
## Let's ask for help...

.center[
&lt;img src="images/pivot_monsters.png" style="width:720px;"/&gt;

[Pivot Monsters](https://rladiessydney.org/courses/ryouwithme/02-cleanitup-5/) drawing by Allison Horst &amp; adjusted by R ladies Sydney
]
---
## Tidying data - Plan of attack

**Messy (1)**: `tidyr` functions `pivot_longer` and `pivot_longer`.  
`pivot_longer (data,names_to,values_to, ...)`: take multiple columns and collapse into key-value pairs

`pivot_wider (data,names_from,values_from,values_fill = NA)`: spread a key-value pair across multiple columns.

**Messy (2)**: `tidyr` function `separate (data, col, into, sep = " ")`: separate one column into multiple columns

**Messy (3)**: `dplyr` : a combination of the functions discussed previously today

**Messy (4)**: `dplyr` functionality `join` (and friends) to combine multiple data sets 

---

## Untidy data


```r
french_fries &lt;- read_csv("frenchfries.csv")
head(french_fries) 
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; treatment &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; subject &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rep &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; potato &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; buttery &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; grassy &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rancid &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; painty &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 61 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 25 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 62 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 26 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 63 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 27 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.3 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## This format is not ideal for data analysis


```r
library(ggplot2)

ggplot(french_fries) + 
geom_boxplot(aes(x="1_buttery", y=buttery), fill = "cyan4") +
geom_boxplot(aes(x = "2_grassy", y = grassy), fill = "darkorange2") +
geom_boxplot(aes(x = "3_painty", y = painty), fill = "darkorchid1") +
geom_boxplot(aes(x = "4_potato", y = potato), fill = "chartreuse3") +
geom_boxplot(aes(x = "5_rancid", y = rancid), fill = "deeppink") +
xlab("variable") + ylab("rating")
```

![](4-tidyr_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;

---

## Tidy your data using `pivot_longer` 
# formerly known as `gather`

.center[
&lt;img src="images/pivot_longer_new.png" style="width:400px;"/&gt;
]

When pivoting longer, you need to specify: 
- the **cols** (identifiers) 
- the **names_to** (new column name)
- the **values_to** (measures from cols)
---

## `pivot_longer` Example


```r
french_fries_long &lt;- french_fries %&gt;% 
  pivot_longer(cols = potato:painty, 
               names_to = "variable", 
               values_to = "rating")

french_fries_long %&gt;% 
  head() %&gt;% 
  knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; treatment &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; subject &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rep &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rating &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; potato &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; buttery &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; grassy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; rancid &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; painty &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; potato &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## This format is better suited for data analysis
.center[

```r
ggplot(french_fries_long) + 
  geom_boxplot(aes(x = variable, y = rating, fill = variable))
```

![](4-tidyr_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;
]

---
## Long to Wide

In certain applications, we may wish to take a long dataset and convert it to a wide dataset (Perhaps displaying in a table).


```r
head(french_fries_long, 3) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; treatment &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; subject &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rep &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rating &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; potato &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; buttery &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; grassy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## Tidy your data using `pivot_wider` 
# formerly known as `spread`


.center[
&lt;img src="images/pivot_wider_new.png" style="width:400px;"/&gt;
]

When pivoting wider, you need to specify:
- the **names_from** (column name that we want to widen)
- the **values_from** (measures from column we want to widen)
---
## `pivot_wider` Example


```r
french_fries_wide &lt;- french_fries_long %&gt;% 
  pivot_wider(names_from = variable, 
              values_from = rating, 
              values_fill = NA)

head(french_fries_wide, 2) %&gt;% 
  knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; treatment &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; subject &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rep &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; potato &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; buttery &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; grassy &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rancid &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; painty &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

We are now back to our original format

---
## `pivot_wider` (cont.)

We can also use the `pivot_wider` function to compare replicates within the French Fry dataset


```r
french_fries_wide &lt;- french_fries_long %&gt;% 
  pivot_wider(names_from = rep, 
              values_from = rating)

head(french_fries_wide, 3) %&gt;% 
  knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; time &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; treatment &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; subject &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 1 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; 2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; potato &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; buttery &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; grassy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## Compare replicates of tested French Fry Data


```r
french_fries_wide %&gt;%
  ggplot(aes(x = `1`, y = `2`)) + 
  geom_point() +
  facet_wrap(~variable) + 
  geom_abline(colour = "grey50")
```

![](4-tidyr_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;
---

class: center, middle

## Motivatinng Example (separate function)

.pull-left[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; states &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; dates &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Lincoln/NE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Aug-2000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chicago/IL &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sep-2001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Ames/IA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Oct-2002 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nashville/TN &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Feb-2001 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]
.pull-right[
![](https://media.giphy.com/media/l2SpYGTTBmGLxSF5C/giphy.gif)
]

---
## Basic Idea: `separate` 
- How do I handle those values in my dataset? Let's use `separate`

.center[
&lt;img src="images/separate.png" style="width:480px;"/&gt;
]

---
## `separate` Example 1


```r
df &lt;- data.frame(x = c(NA, "a.b", "a.d", "b.c"))
df
```

```
##      x
## 1 &lt;NA&gt;
## 2  a.b
## 3  a.d
## 4  b.c
```

```r
df %&gt;% separate(x, into = c("A", "B"))
```

```
##      A    B
## 1 &lt;NA&gt; &lt;NA&gt;
## 2    a    b
## 3    a    d
## 4    b    c
```

---

## `separate` Example 2

```r
df2 &lt;- data.frame(y = c("Lincoln, NE", "Chicago, IL", "Ames, IA", "Nashville, TN"))
df2
```

```
##               y
## 1   Lincoln, NE
## 2   Chicago, IL
## 3      Ames, IA
## 4 Nashville, TN
```

```r
df2 %&gt;% separate(y, c("City", "State"), sep = ", ")
```

```
##        City State
## 1   Lincoln    NE
## 2   Chicago    IL
## 3      Ames    IA
## 4 Nashville    TN
```
---


class: inverse
## Your Turn

The Iowa Data Portal is a wealth of information on and about the State of Iowa. 

The website 
[Campaign Expenditures](https://data.iowa.gov/Government/Campaign-Expenditures/3adi-mht4/data) provides data on campaign expenditures. The code below reads the data into an R session.

---

## Why??


```r
url &lt;- "https://data.iowa.gov/api/views/3adi-mht4/rows.csv"
campaign &lt;- readr::read_csv(url)
```

```
## Warning: One or more parsing issues, see `problems()` for details
```

```
## Rows: 496888 Columns: 16
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (12): Date, Transaction Type, Committee Type, Committee Name, Receiving ...
## dbl  (4): Committee Code, Receiving Committee Code, Expenditure Amount, Chec...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

```r
head(campaign, 3) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Date &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Transaction Type &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Committee Code &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Committee Type &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Committee Name &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Receiving Committee Code &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Receiving Organization Name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; First Name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Last Name &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Address - Line 1 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Address - Line 2 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; City &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; State &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Zip &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Expenditure Amount &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Check Number &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 10/12/2004 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; EXP &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9103 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; County Central Committee &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Jefferson County Democratic Central Committee &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Metcalf for Supervisor &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2642 Hawthorne &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Fairfield &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; IA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 52556 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 518 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 09/09/2004 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; EXP &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9103 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; County Central Committee &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Jefferson County Democratic Central Committee &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Morning Star Studio &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 51 1/2 South Court St. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Fairfield &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; IA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 52556 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 800.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 512 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 12/06/2004 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; EXP &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9103 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; County Central Committee &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Jefferson County Democratic Central Committee &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Morning Star Studio &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 51 1/2 South Court St. &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Fairfield &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; IA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 52556 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 354.56 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 525 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Assess the 'messiness' of the data. List issues that prevent us from working with the data directly. Which of these issues are of type (1) or (2) of messiness?
---

## Problems with the data

- `Date` is text, in the format of Month/Day/Year (Messy 2)

- city coordinates are a combination of City name, state, zip code and geographic latitude and longitude. (Messy 2)

- expenditure amount is a textual expression, not a number (Messy different)

no Messy 1? - problems of type Messy 1 are typically hard to detect and often up to interpretation/dependent on the analysis to be done.

.center[
![](https://media.giphy.com/media/QSdauORwsTtSM/giphy.gif)
]
---

class: inverse

## Your Turn

During the 1870 census data on people's occupation was collected. The data [occupation-1870](../data/occupation-1870.csv) contains state-level aggregates of occupation by gender.

- Use `tidyr` to get the data into a long format (use `pivot_longer`). 

- Separate the `occupation.gender` type variable into two variables.

- "Spread" (use `pivot_wider`) the data such that you can draw scatterplots of values for men against women facetted by occupation.

---
## Dates and Times

Dates are deceptively hard to work with in R.

**Example**: 02/05/2012. Is it February 5th, or May 2nd?

Other things are difficult too:

- Time zones
- POSIXct format in base R is challenging

The **lubridate** package helps tackle some of these issues.

---

## Basic Lubridate Use


```r
library(lubridate) #&lt;&lt; #New Package Alert!!

now()
today()
now() + hours(4)
today() - days(2)
```

```
## [1] "2022-05-17 12:26:29 CDT"
## [1] "2022-05-17"
## [1] "2022-05-17 16:26:29 CDT"
## [1] "2022-05-15"
```

---
## Parsing Dates


```r
ymd("2013-05-14")
mdy("05/14/2013")
dmy("14052013")
ymd_hms("2013:05:14 14:50:30", tz = "America/Chicago")
```

```
## [1] "2013-05-14"
## [1] "2013-05-14"
## [1] "2013-05-14"
## [1] "2013-05-14 14:50:30 CDT"
```

---
class: inverse

## Your Turn 


The flights dataset contains information on over 300,000 flights that departed from New York City in the year 2013.


```r
flights &lt;- 
  read.csv("http://srvanderplas.github.io/rwrks/03-r-format/data/flights.csv")
```


---
class: inverse

## Your Turn

1. Using the `flights` data, create a new column Date using lubridate. You will need to paste together the columns year, month, and day in order to do this. See the `paste` function.

2. Use `dplyr` to calculate the average departure delay for each date.

3. Plot the date versus the average departure delay

![](4-tidyr_files/figure-html/unnamed-chunk-20-1.png)&lt;!-- --&gt;

---
class: inverse

## Your Turn

- Read in the billboard top 100 music data:


```r
billboard &lt;- 
  read.csv("http://srvanderplas.github.io/rwrks/03-r-format/data/billboard.csv")
```
    
- Use `tidyr` to convert this data into a long format.

- Use ``ggplot2`` to create something like this:

![](4-tidyr_files/figure-html/unnamed-chunk-22-1.png)&lt;!-- --&gt;

---

class: inverse

## SOLUTION


```r
long_billboard &lt;- pivot_longer(billboard, cols = X1:X76,
    names_to = "week",
    values_to = "rank", values_drop_na = TRUE) %&gt;%
  mutate(week = parse_number(week))

ggplot(long_billboard) + 
  geom_line(aes(week, rank, colour = artist, group = track))+
  xlim(c(0, 30))
```


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
