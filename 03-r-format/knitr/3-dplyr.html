<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Wrangling</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/bokehjs/bokeh.min.css" rel="stylesheet" />
    <link href="libs/bokehjs/loader.css" rel="stylesheet" />
    <script src="libs/bokehjs/bokeh.min.js"></script>
    <script src="libs/rbokeh-binding/rbokeh.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Data Wrangling
]
.subtitle[
## dplyr
]

---



class: center, middle
.center[
&lt;img src="images/dplyr.png" style="width:580px;"/&gt;

Data Wrangling Cheat Sheet, by [RStudio](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)
]

---
## Motivating Example (Pipe Operator)

.center[
&lt;img src="images/pipe_usage.png" style="width:580px;"/&gt;

Pipe Example, by [Sharp Sight Labs](https://www.sharpsightlabs.com/blog/dplyr-quick-introduction/)
]

---

## The pipe operator `%&gt;%`

`f(x) %&gt;% g(y)` is equivalent to `g(f(x),y)`

i.e. the output of one function is used as input to the next function. This function can be the identity

Consequences:

- `x %&gt;% f(y)` is the same as `f(x,y)`
- statements of the form `k(h(g(f(x,y),z),u),v,w)` become
`x %&gt;% f(y) %&gt;% g(z) %&gt;% h(u) %&gt;% k(v,w)`
- read `%&gt;%` as "then do"
- in non-mathematical terms, the piping operator allows you to apply more than one different function at the same time to the same data frame.

---
## dplyr terminology

There are some of the primary `dplyr` *verbs*, representing distinct data analysis tasks:

- **Filter**: Select specified rows of a data frame, produce subsets

- **Arrange**: Reorder the rows of a data frame

- **Select**: Select particular columns of a data frame

- **Mutate**: Add new or change existing columns of the data frame (as functions of existing columns)

- **Summarise**: Create collapsed summaries of a data frame

- **Group By**: Introduce structure to a data frame
 
---

## Filter

Read in the pitch data set (in the folder 03-r-format/data). The data are from an experiment on different advanced metrics of MLB baseball pitchers different pitch types.

```r
library(tidyverse)
pitch &lt;- 
  read_csv("http://srvanderplas.github.io/rwrks/03-r-format/data/pitch.csv")
pitch[-1] %&gt;% 
  filter(pitcher_hand == "R", pitch_type == "CU") %&gt;%
  head()
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitcher_hand &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitch_type &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; spin_rate &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ab_result &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; action_result &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; adj_h &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3000.024 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3146.456 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3646 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3012.067 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3026.256 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; HB &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3260.956 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3024.533 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

`filter` is similar to the base function `subset`

---
## Filter (cont.)

Multiple conditions in `filter` are combined with a logical AND (i.e. all conditions must be fulfilled) 

e.g. `filter(pitcher_hand == "R", pitch_type == "CU")`

Logical expressions can also be used 

e.g. `filter(pitcher_hand == "R" &amp;  pitch_type == "CU")` or 
`filter(pitch_type == "CU" | subject == "KN")`

---
class: inverse
## Your Turn (~3 minutes) 

1. Use `filter` to get a subset of the `pitchdata` dataset

2. Ex. Filter the data down to left handed pitchers, who throw a curve with at least
3300 rpms (spin_rate), and the play results in a ball (action_result).

3. `%&gt;%` the subset and create a plot

hint: what is the default first argument of the `ggplot` function?

---

## One Solution 


```r
  pitch %&gt;%
  filter(spin_rate &gt;= 3200 &amp; pitcher_hand == "L") %&gt;%
  ggplot(aes(x=action_result, y=spin_rate)) +
  geom_point(aes(color=playerid)) +
  theme(legend.position = "none")
```

![](3-dplyr_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---

## Another Solution (interactive edition)


```r
library(rbokeh) #&lt;&lt; #New Package Alert!!
 pitch %&gt;%
  filter(spin_rate &gt;= 3200 &amp; pitcher_hand == "L") %&gt;%
  figure() %&gt;%
  ly_points(x = action_result, y = spin_rate, color = playerid, 
            hover = list(playerid, spin_rate, action_result), 
            legend = FALSE) 
```

<div id="htmlwidget-d1d73d693a7fdcfae8a7" style="width:504px;height:288px;" class="rbokeh html-widget"></div>
<script type="application/json" data-for="htmlwidget-d1d73d693a7fdcfae8a7">{"x":{"elementid":"f46afd2b666e5d5945c1e93f51b5cde7","modeltype":"Plot","modelid":"be6b615fa0711252473ea02b1ed42ed0","docid":"a5fedac901db5265ede34356f615529c","docs_json":{"a5fedac901db5265ede34356f615529c":{"version":"0.12.5","title":"Bokeh Figure","roots":{"root_ids":["be6b615fa0711252473ea02b1ed42ed0"],"references":[{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","attributes":{"id":"be6b615fa0711252473ea02b1ed42ed0","sizing_mode":"scale_both","x_range":{"type":"FactorRange","id":"2db1a7ffb781be7fc601cc68a7568905"},"y_range":{"type":"Range1d","id":"41903bcfbf9ee07c5594d938f6e4a383"},"left":[{"type":"LinearAxis","id":"3810e1a80215dae4566bdbf7e7cfa8e9"}],"below":[{"type":"CategoricalAxis","id":"74c3063c34b2a04a69ff69bd1cceb470"}],"right":[],"above":[],"renderers":[{"type":"BoxAnnotation","id":"e63bd5c886b2135ae80c470561b6777f"},{"type":"GlyphRenderer","id":"72762fbc8fdd910251c24a6d6fde4e7f"},{"type":"CategoricalAxis","id":"74c3063c34b2a04a69ff69bd1cceb470"},{"type":"Grid","id":"2b51957cc8b523cabe2c2cfdfcfdc5f3"},{"type":"LinearAxis","id":"3810e1a80215dae4566bdbf7e7cfa8e9"},{"type":"Grid","id":"f8f0691aa5af4920a59efddad7ebb3b1"}],"extra_y_ranges":{},"extra_x_ranges":{},"tags":[],"min_border_left":4,"min_border_right":4,"min_border_top":4,"min_border_bottom":4,"lod_threshold":null,"toolbar":{"type":"Toolbar","id":"f8a16c202857ae36479810b03afe7cac"},"tool_events":{"type":"ToolEvents","id":"e8e52f990d0f2f7c95a5993c198bcfe5"}},"subtype":"Figure"},{"type":"Toolbar","id":"f8a16c202857ae36479810b03afe7cac","attributes":{"id":"f8a16c202857ae36479810b03afe7cac","tags":[],"active_drag":"auto","active_scroll":"auto","active_tap":"auto","tools":[{"type":"PanTool","id":"d11e075fb892fdb22369d275df53ce74"},{"type":"WheelZoomTool","id":"1782e788110326336eef376ab1ebb214"},{"type":"BoxZoomTool","id":"d9ee367dbac49ccadcd67bb12c44314e"},{"type":"ResetTool","id":"a22903fc9c061524521474439681765c"},{"type":"SaveTool","id":"be073087123ea6c692f70c29b57c1d3a"},{"type":"HelpTool","id":"3219559d3bf4a533f223a85ed57eea21"},{"type":"HoverTool","id":"ba9417e44b5376feefd1a12664362a92"}],"logo":null}},{"type":"PanTool","id":"d11e075fb892fdb22369d275df53ce74","attributes":{"id":"d11e075fb892fdb22369d275df53ce74","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"dimensions":"both"}},{"type":"ToolEvents","id":"e8e52f990d0f2f7c95a5993c198bcfe5","attributes":{"id":"e8e52f990d0f2f7c95a5993c198bcfe5","tags":[]},"geometries":[]},{"type":"WheelZoomTool","id":"1782e788110326336eef376ab1ebb214","attributes":{"id":"1782e788110326336eef376ab1ebb214","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"dimensions":"both"}},{"type":"BoxAnnotation","id":"e63bd5c886b2135ae80c470561b6777f","attributes":{"id":"e63bd5c886b2135ae80c470561b6777f","tags":[],"line_color":{"units":"data","value":"black"},"line_alpha":{"units":"data","value":1},"fill_color":{"units":"data","value":"lightgrey"},"fill_alpha":{"units":"data","value":0.5},"line_dash":[4,4],"line_width":{"units":"data","value":2},"level":"overlay","top_units":"screen","bottom_units":"screen","left_units":"screen","right_units":"screen","render_mode":"css"}},{"type":"BoxZoomTool","id":"d9ee367dbac49ccadcd67bb12c44314e","attributes":{"id":"d9ee367dbac49ccadcd67bb12c44314e","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"overlay":{"type":"BoxAnnotation","id":"e63bd5c886b2135ae80c470561b6777f"}}},{"type":"ResetTool","id":"a22903fc9c061524521474439681765c","attributes":{"id":"a22903fc9c061524521474439681765c","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"}}},{"type":"SaveTool","id":"be073087123ea6c692f70c29b57c1d3a","attributes":{"id":"be073087123ea6c692f70c29b57c1d3a","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"}}},{"type":"HelpTool","id":"3219559d3bf4a533f223a85ed57eea21","attributes":{"id":"3219559d3bf4a533f223a85ed57eea21","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"redirect":"https://hafen.github.io/rbokeh/","help_tooltip":"Click to learn more about rbokeh."}},{"type":"HoverTool","id":"ba9417e44b5376feefd1a12664362a92","attributes":{"id":"ba9417e44b5376feefd1a12664362a92","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"renderers":[{"type":"GlyphRenderer","id":"72762fbc8fdd910251c24a6d6fde4e7f"}],"names":[],"anchor":"center","attachment":"horizontal","line_policy":"prev","mode":"mouse","point_policy":"snap_to_data","tooltips":[["playerid","@hover_col_1"],["spin_rate","@hover_col_2"],["action_result","@hover_col_3"]]}},{"type":"ColumnDataSource","id":"fea6ef804c875d4ef642aeac7ee79627","attributes":{"id":"fea6ef804c875d4ef642aeac7ee79627","tags":[],"column_names":["x","y","line_color","fill_color","hover_col_1","hover_col_2","hover_col_3"],"selected":[],"data":{"x":["B","B","S","F","B","F","B","B","B"],"y":[3286.313,3248.3821,3203.5969,3237.7629,3278.4861,3237.9861,3226.5071,3206.4629,3264.386],"line_color":["#238B45","#0B7734","#0B7734","#0B7734","#66C2A4","#37A265","#37A265","#00441B","#00441B"],"fill_color":["#238B45","#0B7734","#0B7734","#0B7734","#66C2A4","#37A265","#37A265","#00441B","#00441B"],"hover_col_1":[" 7291"," 8247"," 8247"," 8247","  607"," 4629"," 4629","13586","13586"],"hover_col_2":["3286.313","3248.382","3203.597","3237.763","3278.486","3237.986","3226.507","3206.463","3264.386"],"hover_col_3":["B","B","S","F","B","F","B","B","B"]}}},{"type":"Circle","id":"6632f09377a57001682a730b39445d99","attributes":{"id":"6632f09377a57001682a730b39445d99","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"Circle","id":"d9bd2c9bf842f7d9c0ae1f64914aa80b","attributes":{"id":"d9bd2c9bf842f7d9c0ae1f64914aa80b","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","value":"#e1e1e1"},"fill_color":{"units":"data","value":"#e1e1e1"}}},{"type":"Circle","id":"0ff5268d1284940b334b86b50652a866","attributes":{"id":"0ff5268d1284940b334b86b50652a866","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":1},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"GlyphRenderer","id":"72762fbc8fdd910251c24a6d6fde4e7f","attributes":{"id":"72762fbc8fdd910251c24a6d6fde4e7f","tags":[],"selection_glyph":null,"nonselection_glyph":{"type":"Circle","id":"d9bd2c9bf842f7d9c0ae1f64914aa80b"},"hover_glyph":{"type":"Circle","id":"0ff5268d1284940b334b86b50652a866"},"name":null,"data_source":{"type":"ColumnDataSource","id":"fea6ef804c875d4ef642aeac7ee79627"},"glyph":{"type":"Circle","id":"6632f09377a57001682a730b39445d99"}}},{"type":"FactorRange","id":"2db1a7ffb781be7fc601cc68a7568905","attributes":{"id":"2db1a7ffb781be7fc601cc68a7568905","tags":[],"factors":["B","F","S"]}},{"type":"Range1d","id":"41903bcfbf9ee07c5594d938f6e4a383","attributes":{"id":"41903bcfbf9ee07c5594d938f6e4a383","tags":[],"start":3197.806773,"end":3292.103127}},{"type":"CategoricalAxis","id":"74c3063c34b2a04a69ff69bd1cceb470","attributes":{"id":"74c3063c34b2a04a69ff69bd1cceb470","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"axis_label":"action_result","formatter":{"type":"CategoricalTickFormatter","id":"f066e2b4545b2cab4b86398b3e6cc96c"},"ticker":{"type":"CategoricalTicker","id":"49e8c93ff38c528aa18789544db97084"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"CategoricalTickFormatter","id":"f066e2b4545b2cab4b86398b3e6cc96c","attributes":{"id":"f066e2b4545b2cab4b86398b3e6cc96c","tags":[]}},{"type":"CategoricalTicker","id":"49e8c93ff38c528aa18789544db97084","attributes":{"id":"49e8c93ff38c528aa18789544db97084","tags":[]}},{"type":"Grid","id":"2b51957cc8b523cabe2c2cfdfcfdc5f3","attributes":{"id":"2b51957cc8b523cabe2c2cfdfcfdc5f3","tags":[],"dimension":0,"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"ticker":{"type":"CategoricalTicker","id":"49e8c93ff38c528aa18789544db97084"}}},{"type":"LinearAxis","id":"3810e1a80215dae4566bdbf7e7cfa8e9","attributes":{"id":"3810e1a80215dae4566bdbf7e7cfa8e9","tags":[],"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"axis_label":"spin_rate","formatter":{"type":"BasicTickFormatter","id":"b03d481216c58ee7e0733433cbc5827f"},"ticker":{"type":"BasicTicker","id":"800d7ff41ba900f1328ba419582ba6ce"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"BasicTickFormatter","id":"b03d481216c58ee7e0733433cbc5827f","attributes":{"id":"b03d481216c58ee7e0733433cbc5827f","tags":[]}},{"type":"BasicTicker","id":"800d7ff41ba900f1328ba419582ba6ce","attributes":{"id":"800d7ff41ba900f1328ba419582ba6ce","tags":[],"num_minor_ticks":5}},{"type":"Grid","id":"f8f0691aa5af4920a59efddad7ebb3b1","attributes":{"id":"f8f0691aa5af4920a59efddad7ebb3b1","tags":[],"dimension":1,"plot":{"type":"Plot","id":"be6b615fa0711252473ea02b1ed42ed0","subtype":"Figure"},"ticker":{"type":"BasicTicker","id":"800d7ff41ba900f1328ba419582ba6ce"}}}]}}},"debug":false},"evals":[],"jsHooks":[]}</script>

---


## Arrange

Easy way to arrange your data in ascending or descending order

```r
pitch %&gt;% 
  subset(select = c("playerid", "spin_rate")) %&gt;%
  arrange(desc(playerid), spin_rate) %&gt;% 
  head(5) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; spin_rate &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3055.508 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3072.307 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3075.055 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3164.546 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15686 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3032.944 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Successive variables are used for breaking ties from previous variables.


```r
pitch %&gt;% 
  subset(select = c("playerid", "spin_rate")) %&gt;%
  arrange(playerid, spin_rate) %&gt;% 
  head(5) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; spin_rate &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3012.770 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3017.095 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3024.533 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3028.328 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3040.097 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: inverse

## Your Turn

1. Look up the help file for the function `slice`.

2. Use `slice` on the arranged `pitchdata` dataset to select a single row

3. use `slice` to select multiple rows

Hint: Use the entire data set

---

## Solution


```r
pitch %&gt;% 
  arrange(desc(playerid), spin_rate) %&gt;% 
  slice(11) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; ...1 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitcher_hand &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitch_type &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; spin_rate &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ab_result &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; action_result &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; adj_h &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 664 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15540 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3041.712 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



```r
pitch %&gt;% 
  arrange(desc(playerid), spin_rate) %&gt;% 
  slice(1:5) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; ...1 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitcher_hand &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitch_type &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; spin_rate &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ab_result &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; action_result &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; adj_h &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 966 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3055.508 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1136 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3072.307 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1165 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3075.055 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1411 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3164.546 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 649 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15686 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CU &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3032.944 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; K &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; S &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## Select
 - Using Select we are easily able to create a subset of our data. This is similar to
 the subset function in base.

```r
pitch %&gt;% 
  select(playerid, pitcher_hand, action_result, spin_rate) %&gt;%
  head() %&gt;% 
  knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; pitcher_hand &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; action_result &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; spin_rate &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3000.024 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 959 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; L &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3051.596 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3146.456 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3646 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3012.067 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; R &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3026.256 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; L &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3038.633 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## Summarise
 - Finding summary statistics of a metric

```r
pitch %&gt;%
    summarise(mean_spinrate = mean(spin_rate, na.rm=TRUE), 
              sd_spinrate = sd(spin_rate, na.rm = TRUE)) %&gt;% 
  knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; mean_spinrate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sd_spinrate &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3125.67 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 109.8614 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## `summarise` and `group_by`
 - Finding summary statistics of a metric after accounting first for other variables

```r
pitch %&gt;%
    group_by(playerid) %&gt;%
    summarise(mean_spinrate = mean(spin_rate, na.rm=TRUE), 
              sd_spinrate = sd(spin_rate, na.rm = TRUE)) %&gt;% 
  knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mean_spinrate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sd_spinrate &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 476 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3065.601 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.649566 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 607 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3278.486 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 657 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3042.489 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.011461 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 959 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3056.323 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.857567 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1030 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3044.114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37.697369 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1241 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3003.599 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4.539060 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1489 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3068.265 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.529250 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1802 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3238.680 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 130.224607 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1828 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3058.305 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 52.417827 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1862 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3062.239 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 39.612043 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1868 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3057.873 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47.387782 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1948 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3105.352 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.046157 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2165 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3017.442 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2295 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3053.507 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37.840114 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2496 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3020.295 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2730 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3023.293 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.688727 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2732 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3299.791 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 85.411613 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2795 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3186.867 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 132.864476 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2850 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3136.519 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 86.615289 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3055 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3096.112 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 61.728373 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3062 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3061.021 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50.075608 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3138 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3087.497 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 66.037450 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3153 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3037.562 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.718281 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3229 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3024.050 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.962541 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3282 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3011.777 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3394 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3033.231 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.729926 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3646 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3034.257 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.768844 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3787 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3015.778 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4198 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3052.810 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48.576690 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4222 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3057.311 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37.768794 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4378 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3019.010 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 24.268470 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4444 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3033.526 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4482 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3069.067 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.703762 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4629 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3099.800 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.049141 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4847 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3118.608 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 116.134062 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4878 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3126.128 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 69.195451 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5596 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3050.714 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5620 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3015.548 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.785872 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5734 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3027.632 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5829 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3087.657 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72.157649 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5967 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3058.993 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 54.166893 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6222 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3072.277 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 75.010464 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6586 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3068.913 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55.158073 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7171 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3063.831 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.504440 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7291 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3074.848 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.141670 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7325 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3038.254 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37.709863 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3073.502 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 62.057767 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8284 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3053.497 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 51.828308 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8288 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3084.907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82.888416 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8447 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3029.856 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.632082 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8839 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3052.990 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8850 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3047.807 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.699579 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 9627 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3034.691 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13.048591 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10045 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3277.716 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 108.280583 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10686 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3036.178 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36.041459 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11504 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3048.686 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.643353 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11533 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3003.915 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11683 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3042.749 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.730190 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 13586 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3069.638 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 57.121853 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14170 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3077.539 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79.793621 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14344 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3129.260 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 79.249641 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15315 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3119.850 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 72.922234 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15540 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3106.726 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 68.459131 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15686 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3032.944 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3091.854 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49.225453 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: inverse

## Your Turn

1. Select only playerid, spin_rate, and action result

2. Group by both playerid and action result and find mean and sd of spin rates 

3. `%&gt;%` the summaries into a `ggplot` histogram

---

## A Solution


```r
pitch %&gt;%
  select(playerid, spin_rate, action_result) %&gt;%
    group_by(playerid, action_result) %&gt;%
    summarise(mean_spin = mean(spin_rate), 
              sd_spin = sd(spin_rate)) %&gt;%
* ggplot(aes(x = mean_spin)) + geom_histogram()
```

![](3-dplyr_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---

## `mutate`

 - Change an existing or create a new variable into the data
 
 - Creating a new column in your data set that represents something new
 
 - Great for calculations 
 
 - How would I create a calculation for how far above or below each players pitches are from their own average spin rates?
 

```r
pitch %&gt;%
    select(playerid, spin_rate, action_result) %&gt;%
    group_by(playerid, action_result) %&gt;%
    summarise(mean_spin = mean(spin_rate), 
              sd_spin = sd(spin_rate)) %&gt;%
    mutate(mean = sum(mean_spin) / n()) %&gt;%
    mutate(difference = mean - mean_spin)
```

```
## # A tibble: 218 × 6
## # Groups:   playerid [65]
##    playerid action_result mean_spin sd_spin  mean difference
##       &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1      476 B                 3077.   52.1  3058.     -19.1 
##  2      476 F                 3101.    1.69 3058.     -43.4 
##  3      476 S                 3041.   17.0  3058.      17.2 
##  4      476 X                 3013.   NA    3058.      45.3 
##  5      607 B                 3278.   NA    3278.       0   
##  6      657 B                 3047.   46.2  3036.     -11.2 
##  7      657 F                 3025.   34.7  3036.      11.2 
##  8      959 B                 3066.   53.6  3057.      -9.56
##  9      959 C                 3039.   35.6  3057.      18.0 
## 10      959 F                 3054.   38.1  3057.       3.00
## # … with 208 more rows
```

---
## Utilzing `ifelse`
- Sometimes you are tasked to create a new column based on a clause

- `ifelse` function allows you to create an if else statement within the creation 
of the new variable.

- Consider rewriting the handedness of our pitchers.

- If the pitcher_hand is R write "Right" if not, "Left"

```
## # A tibble: 2,239 × 2
##    pitcher_hand Handedness
##    &lt;chr&gt;        &lt;chr&gt;     
##  1 R            Right     
##  2 L            Left      
##  3 R            Right     
##  4 R            Right     
##  5 R            Right     
##  6 L            Left      
##  7 L            Left      
##  8 R            Right     
##  9 R            Right     
## 10 R            Right     
## # … with 2,229 more rows
```

---

## Caution with pipe operator

Why does `pitch$mean_spin` not return a real-valued summary??


```
## NULL
```

--

## Reasons for pipe operator mishaps

- When we use the piping operator like we have been, the data is only ever being
changed within 
- We only ever look at this new variable in the previous chunk.
- It has not been created globally into the dataset itself

--
- To do this, you need to create your new column by declaring it as its own variable.

```r
pitch$mean_spin &lt;- mean(pitch$spin_rate)
```


---

## `mutate` OR `summarize`?

Both commands introduce new variables - so which one should we use?

.pull-left[
`mutate` 

- **adds variables** to the existing data set

- The resulting variables must have the **same length** as the original data

- e.g. use for transformations, combinations of multiple variables

]

.pull-right[
`summarize` 

- **creates aggregates** of the original data

- The number of rows of the new dataset is determined by the number of combinations of the grouping structure. 

- The number of columns is determined by the number of grouping variables and the summary statistics.
]

---

## Shortcuts


`summarize(n = n())` is equivalent to `tally()` 


```r
pitch %&gt;% tally()
pitch %&gt;% summarize(n=n())
```


`group_by(playerid, action_result) %&gt;% summarize(n = n())` is equivalent to `count(playerid, action_result)`


```r
pitch %&gt;% count(playerid, action_result)
pitch %&gt;% group_by(playerid, action_result) %&gt;% summarize(n=n())
```
---
class: inverse
## Your Turn (10 min) 


Based on your (limited) knowledge of baseball, you determine what is a "successful" curveball.
Then determine what pitchers pitched the most successful curveballs!

Note: There are many different ways of answering this question. None are wrong and you don't need to know anything about baseball to try. Consider criteria that it needs to meet. Ex. A successful curveball needs to be above 90 mph in velocity and have over 3100 rpms in spin rate.

utilize the `sum()` function to add up all your curveballs!
---

## One Solution
Consider a success any strike and any batted ball resulting in a "adj_h" less than the league average of .300 BABIP (according to MLB.com)

```r
SScurve &lt;- pitch %&gt;%
  select("playerid", "action_result", "ab_result", "adj_h") %&gt;%  
  arrange(desc(playerid)) %&gt;% 
  mutate(successfulCU = ifelse(
    (adj_h &lt; .3 &amp; ab_result != "\\N" ) | 
    (action_result %in% c("C","S","F")), 1, 0)) %&gt;%
  group_by(playerid) %&gt;% 
  mutate(totalSSCU=sum(successfulCU)) %&gt;% 
  mutate(percentSSCU=totalSSCU / n())
SScurve %&gt;% head(2) %&gt;% knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; playerid &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; action_result &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ab_result &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; adj_h &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; successfulCU &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; totalSSCU &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; percentSSCU &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16669 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \N &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## Solution (cont.)
1. Calculate successful curveball percentages
2. Look at some graphs to see what the data actually looks like now. 

```r
percentages &lt;- SScurve %&gt;% 
  distinct(playerid, totalSSCU, percentSSCU)

library(rbokeh)
library(quanteda) #&lt;&lt; #New Package Alert!!
ggplot(data = percentages) + 
  geom_point(aes(x = percentSSCU, y = totalSSCU,
                 colour = playerid))
```

![](3-dplyr_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;

---

## Solution (cont.)
Filter down to get the best pitchers with a minimum of 50 curveballs thrown (our median)

```r
qualifiedPercentages &lt;- percentages %&gt;% 
  filter(totalSSCU &gt; 50) %&gt;% 
  arrange(desc(percentSSCU))

figure() %&gt;%
  ly_points(x = percentSSCU, y = totalSSCU, color = playerid,
            data = qualifiedPercentages, 
            hover = list(playerid, totalSSCU, percentSSCU), 
            legend = FALSE)
```

<div id="htmlwidget-62e1f82c0b74752d1ea7" style="width:504px;height:216px;" class="rbokeh html-widget"></div>
<script type="application/json" data-for="htmlwidget-62e1f82c0b74752d1ea7">{"x":{"elementid":"922ef95b78e5617a0f30606bc215f60a","modeltype":"Plot","modelid":"f1c2933c88b254ce9307ed518577f31b","docid":"cb1da8cf5cfa54e24f0f9dc5f0535380","docs_json":{"cb1da8cf5cfa54e24f0f9dc5f0535380":{"version":"0.12.5","title":"Bokeh Figure","roots":{"root_ids":["f1c2933c88b254ce9307ed518577f31b"],"references":[{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","attributes":{"id":"f1c2933c88b254ce9307ed518577f31b","sizing_mode":"scale_both","x_range":{"type":"Range1d","id":"3ace18b567129507e8930e865e4dcc15"},"y_range":{"type":"Range1d","id":"31ce2fe2656247a907a4cfbeb8bf6295"},"left":[{"type":"LinearAxis","id":"5eb7f6f583ed2aab8461e3245a049800"}],"below":[{"type":"LinearAxis","id":"3f3b5b359f9777f6ea4ac9e585d4bcc8"}],"right":[],"above":[],"renderers":[{"type":"BoxAnnotation","id":"60627bd37e7924a2b121f4013d1ec6b6"},{"type":"GlyphRenderer","id":"d3fbae710c8d2feaf3cdb0abc69fef9c"},{"type":"LinearAxis","id":"3f3b5b359f9777f6ea4ac9e585d4bcc8"},{"type":"Grid","id":"a0b50dbf9fbb8ec6bfbd0dd1ce115183"},{"type":"LinearAxis","id":"5eb7f6f583ed2aab8461e3245a049800"},{"type":"Grid","id":"af5c2b29ad09cb96ab153aeee6da54de"}],"extra_y_ranges":{},"extra_x_ranges":{},"tags":[],"min_border_left":4,"min_border_right":4,"min_border_top":4,"min_border_bottom":4,"lod_threshold":null,"toolbar":{"type":"Toolbar","id":"a0afa6fccd6b79d4fed124ce06b59993"},"tool_events":{"type":"ToolEvents","id":"c0a9b96ae479ed8a1a44e64949028574"}},"subtype":"Figure"},{"type":"Toolbar","id":"a0afa6fccd6b79d4fed124ce06b59993","attributes":{"id":"a0afa6fccd6b79d4fed124ce06b59993","tags":[],"active_drag":"auto","active_scroll":"auto","active_tap":"auto","tools":[{"type":"PanTool","id":"5776671e60bbfd68ec8bab92af05e1d0"},{"type":"WheelZoomTool","id":"5407845b3369dc26033f5ba60f236e76"},{"type":"BoxZoomTool","id":"5dda565c439b5b86c68d62fb45b46acc"},{"type":"ResetTool","id":"f60b965abd839e8d0f7b11d7cc019334"},{"type":"SaveTool","id":"9d37e6bd61789a0b1466f9f093ca889c"},{"type":"HelpTool","id":"f8b959559fa85763b2427fb07e1c253e"},{"type":"HoverTool","id":"c11b18e25cede2e12e967f8acd79e7d8"}],"logo":null}},{"type":"PanTool","id":"5776671e60bbfd68ec8bab92af05e1d0","attributes":{"id":"5776671e60bbfd68ec8bab92af05e1d0","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"dimensions":"both"}},{"type":"ToolEvents","id":"c0a9b96ae479ed8a1a44e64949028574","attributes":{"id":"c0a9b96ae479ed8a1a44e64949028574","tags":[]},"geometries":[]},{"type":"WheelZoomTool","id":"5407845b3369dc26033f5ba60f236e76","attributes":{"id":"5407845b3369dc26033f5ba60f236e76","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"dimensions":"both"}},{"type":"BoxAnnotation","id":"60627bd37e7924a2b121f4013d1ec6b6","attributes":{"id":"60627bd37e7924a2b121f4013d1ec6b6","tags":[],"line_color":{"units":"data","value":"black"},"line_alpha":{"units":"data","value":1},"fill_color":{"units":"data","value":"lightgrey"},"fill_alpha":{"units":"data","value":0.5},"line_dash":[4,4],"line_width":{"units":"data","value":2},"level":"overlay","top_units":"screen","bottom_units":"screen","left_units":"screen","right_units":"screen","render_mode":"css"}},{"type":"BoxZoomTool","id":"5dda565c439b5b86c68d62fb45b46acc","attributes":{"id":"5dda565c439b5b86c68d62fb45b46acc","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"overlay":{"type":"BoxAnnotation","id":"60627bd37e7924a2b121f4013d1ec6b6"}}},{"type":"ResetTool","id":"f60b965abd839e8d0f7b11d7cc019334","attributes":{"id":"f60b965abd839e8d0f7b11d7cc019334","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"}}},{"type":"SaveTool","id":"9d37e6bd61789a0b1466f9f093ca889c","attributes":{"id":"9d37e6bd61789a0b1466f9f093ca889c","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"}}},{"type":"HelpTool","id":"f8b959559fa85763b2427fb07e1c253e","attributes":{"id":"f8b959559fa85763b2427fb07e1c253e","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"redirect":"https://hafen.github.io/rbokeh/","help_tooltip":"Click to learn more about rbokeh."}},{"type":"HoverTool","id":"c11b18e25cede2e12e967f8acd79e7d8","attributes":{"id":"c11b18e25cede2e12e967f8acd79e7d8","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"renderers":[{"type":"GlyphRenderer","id":"d3fbae710c8d2feaf3cdb0abc69fef9c"}],"names":[],"anchor":"center","attachment":"horizontal","line_policy":"prev","mode":"mouse","point_policy":"snap_to_data","tooltips":[["playerid","@hover_col_1"],["totalSSCU","@hover_col_2"],["percentSSCU","@hover_col_3"]]}},{"type":"ColumnDataSource","id":"755e3bb0e33a7aebdd3b731b05d391df","attributes":{"id":"755e3bb0e33a7aebdd3b731b05d391df","tags":[],"column_names":["x","y","line_color","fill_color","hover_col_1","hover_col_2","hover_col_3"],"selected":[],"data":{"x":[0.666666666666667,0.634615384615385,0.621848739495798,0.603351955307263,0.543814432989691,0.53030303030303],"y":[60,66,74,108,211,70],"line_color":["#66C2A4","#3CA96F","#50B689","#05712F","#00441B","#50B689"],"fill_color":["#66C2A4","#3CA96F","#50B689","#05712F","#00441B","#50B689"],"hover_col_1":[" 1030"," 4878"," 2850","10045","14344"," 3138"],"hover_col_2":[" 60"," 66"," 74","108","211"," 70"],"hover_col_3":["0.6666667","0.6346154","0.6218487","0.6033520","0.5438144","0.5303030"]}}},{"type":"Circle","id":"19a84eb489e3e1e7d9fd9f1a0510d42d","attributes":{"id":"19a84eb489e3e1e7d9fd9f1a0510d42d","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"Circle","id":"c9d894a50e67b2b85e11f9a27dfb2d67","attributes":{"id":"c9d894a50e67b2b85e11f9a27dfb2d67","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":0.5},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","value":"#e1e1e1"},"fill_color":{"units":"data","value":"#e1e1e1"}}},{"type":"Circle","id":"7a7b9d4aaed426d4bb9d4adf0173d583","attributes":{"id":"7a7b9d4aaed426d4bb9d4adf0173d583","tags":[],"size":{"units":"screen","value":10},"line_alpha":{"units":"data","value":1},"fill_alpha":{"units":"data","value":1},"x":{"units":"data","field":"x"},"y":{"units":"data","field":"y"},"line_color":{"units":"data","field":"line_color"},"fill_color":{"units":"data","field":"fill_color"}}},{"type":"GlyphRenderer","id":"d3fbae710c8d2feaf3cdb0abc69fef9c","attributes":{"id":"d3fbae710c8d2feaf3cdb0abc69fef9c","tags":[],"selection_glyph":null,"nonselection_glyph":{"type":"Circle","id":"c9d894a50e67b2b85e11f9a27dfb2d67"},"hover_glyph":{"type":"Circle","id":"7a7b9d4aaed426d4bb9d4adf0173d583"},"name":null,"data_source":{"type":"ColumnDataSource","id":"755e3bb0e33a7aebdd3b731b05d391df"},"glyph":{"type":"Circle","id":"19a84eb489e3e1e7d9fd9f1a0510d42d"}}},{"type":"Range1d","id":"3ace18b567129507e8930e865e4dcc15","attributes":{"id":"3ace18b567129507e8930e865e4dcc15","tags":[],"start":0.520757575757576,"end":0.676212121212121}},{"type":"Range1d","id":"31ce2fe2656247a907a4cfbeb8bf6295","attributes":{"id":"31ce2fe2656247a907a4cfbeb8bf6295","tags":[],"start":49.43,"end":221.57}},{"type":"LinearAxis","id":"3f3b5b359f9777f6ea4ac9e585d4bcc8","attributes":{"id":"3f3b5b359f9777f6ea4ac9e585d4bcc8","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"axis_label":"percentSSCU","formatter":{"type":"BasicTickFormatter","id":"f028af55c5758c601c643ad9c3b53194"},"ticker":{"type":"BasicTicker","id":"f87d98c76960eda1288653f7d59373c7"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"BasicTickFormatter","id":"f028af55c5758c601c643ad9c3b53194","attributes":{"id":"f028af55c5758c601c643ad9c3b53194","tags":[]}},{"type":"BasicTicker","id":"f87d98c76960eda1288653f7d59373c7","attributes":{"id":"f87d98c76960eda1288653f7d59373c7","tags":[],"num_minor_ticks":5}},{"type":"Grid","id":"a0b50dbf9fbb8ec6bfbd0dd1ce115183","attributes":{"id":"a0b50dbf9fbb8ec6bfbd0dd1ce115183","tags":[],"dimension":0,"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"ticker":{"type":"BasicTicker","id":"f87d98c76960eda1288653f7d59373c7"}}},{"type":"LinearAxis","id":"5eb7f6f583ed2aab8461e3245a049800","attributes":{"id":"5eb7f6f583ed2aab8461e3245a049800","tags":[],"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"axis_label":"totalSSCU","formatter":{"type":"BasicTickFormatter","id":"92fc60d70bacd6f3d8c9b8d65e208fd5"},"ticker":{"type":"BasicTicker","id":"6e20bac345e32cec68ecec8fbe2e3f6b"},"visible":true,"axis_label_text_font_size":"12pt"}},{"type":"BasicTickFormatter","id":"92fc60d70bacd6f3d8c9b8d65e208fd5","attributes":{"id":"92fc60d70bacd6f3d8c9b8d65e208fd5","tags":[]}},{"type":"BasicTicker","id":"6e20bac345e32cec68ecec8fbe2e3f6b","attributes":{"id":"6e20bac345e32cec68ecec8fbe2e3f6b","tags":[],"num_minor_ticks":5}},{"type":"Grid","id":"af5c2b29ad09cb96ab153aeee6da54de","attributes":{"id":"af5c2b29ad09cb96ab153aeee6da54de","tags":[],"dimension":1,"plot":{"type":"Plot","id":"f1c2933c88b254ce9307ed518577f31b","subtype":"Figure"},"ticker":{"type":"BasicTicker","id":"6e20bac345e32cec68ecec8fbe2e3f6b"}}}]}}},"debug":false},"evals":[],"jsHooks":[]}</script>


---
class: inverse

##  Your Turn

The dataset `ChickWeight` is part of the core packages that come with R 

**Hint**: `data(ChickWeight)` gets the data into your active session.

From the help file:

&gt; four groups of chicks on different protein diets. The body weights of the chicks were measured at birth and every second day thereafter until day 20. They were also measured on day 21.

![](http://www.kenaifeed.com/wp-content/uploads/2015/03/chicks.jpg)

---
class: inverse

## Your Turn

1. Create a line plot with each line representing the weight of each Chick 

2. Focus on weight on day 21. Draw side-by-side dotplots of weight by diet. 

3. **Bonus**: Use `summarize` the average weight on day 21 under each diet. Overlay the dotplots by error bars around the average weight under each diet (see `?geom_errorbar`)

**Hint** for 1: check out `?group` and consider what varible or variables you might map to this option

---

##  Solution - Q1


```r
ChickWeight %&gt;% 
  ggplot(aes(x=Time, y=weight, group=Chick, color=Diet)) +
  geom_line() + 
  facet_wrap(~Diet)
```

![](3-dplyr_files/figure-html/unnamed-chunk-20-1.png)&lt;!-- --&gt;

---

##  Solution - Q2


```r
ChickWeight %&gt;%   
  filter(Time==21) %&gt;% 
  ggplot(aes(x=Diet)) +
  geom_point(aes(y=weight, color=Diet), size=3)
```

![](3-dplyr_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;

---

##  Solution - Q3 

First, we need a separate dataset for the summary statistics:


```r
ChickW1 &lt;- ChickWeight %&gt;% 
  filter(Time==21) %&gt;% 
  group_by(Diet) %&gt;% 
  summarize(mean_weight = mean(weight, na.rm=TRUE),
            sd_weight = sd(weight, na.rm=TRUE)/n())
```

---

##  Solution - Q3 (cont)


```r
ChickWeight %&gt;% 
  filter(Time==21) %&gt;% 
  ggplot(aes(x=Diet)) +
  geom_point(aes(y=weight), size=2) +
  geom_errorbar(data= ChickW1, 
                aes(ymin = mean_weight-1.96*sd_weight, 
                    ymax = mean_weight+1.96*sd_weight, 
                    colour = Diet), width=.3) +
  geom_point(data=ChickW1, aes(y=mean_weight, color=Diet), size=3)
```

![](3-dplyr_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---

## `Mutate` is incredibly flexible

Consider a new variable `gain`, which gives the increase in weight of a chick since birth


```r
ChickPlus &lt;- ChickWeight %&gt;% 
  group_by(Chick) %&gt;% 
  mutate(gain = weight - weight[Time == 0])
```

.pull-left[

```r
ChickPlus %&gt;% 
  filter(Chick == 1) %&gt;% 
  select(-Diet) %&gt;% 
  glimpse()
```

```
## Rows: 12
## Columns: 4
## Groups: Chick [1]
## $ weight &lt;dbl&gt; 42, 51, 59, 64, 76, 93, 106, 125, 149, 171, 199, 205
## $ Time   &lt;dbl&gt; 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 21
## $ Chick  &lt;ord&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
## $ gain   &lt;dbl&gt; 0, 9, 17, 22, 34, 51, 64, 83, 107, 129, 157, 163
```
]

.pull-right[

```r
ChickPlus %&gt;% 
  filter(Chick == 1) %&gt;% 
  ungroup() %&gt;% 
  select(-Diet, -Chick) %&gt;% 
  glimpse()
```

```
## Rows: 12
## Columns: 3
## $ weight &lt;dbl&gt; 42, 51, 59, 64, 76, 93, 106, 125, 149, 171, 199, 205
## $ Time   &lt;dbl&gt; 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 21
## $ gain   &lt;dbl&gt; 0, 9, 17, 22, 34, 51, 64, 83, 107, 129, 157, 163
```
]
---

## Plotting weight gain


```r
ChickPlus %&gt;% 
  ggplot(aes(x = Time, y = gain, group = Chick)) + 
  geom_line(aes(color=Diet)) +
  facet_wrap(~Diet)
```

![](3-dplyr_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;

---

## Re-cap

- getting used to `dplyr` actions can take a bit of time and practice

- recognize keywords and match them to `dplyr` functions

- incorporate `dplyr` functions in your regular workflow - the long-term benefits are there, promise!




&lt;!-- ## Are replicates similar? --&gt;

&lt;!-- ```{r fig.width = 4.5, fig.height=4.5} --&gt;
&lt;!-- reps &lt;- french_fries %&gt;%  --&gt;
&lt;!--   group_by(time, subject, treatment) %&gt;% --&gt;
&lt;!--   summarise(potato_diff = diff(potato), --&gt;
&lt;!--             potato = mean(potato)) --&gt;

&lt;!-- reps --&gt;
&lt;!-- ``` --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Are replicates similar? (contd.) --&gt;

&lt;!-- ```{r fig.height=4, warning=FALSE} --&gt;
&lt;!-- reps %&gt;%  --&gt;
&lt;!--   ggplot(aes(x = potato, y = potato_diff, colour = as.numeric(time))) +  --&gt;
&lt;!--   facet_wrap(~subject) + --&gt;
&lt;!--   geom_hline(aes(yintercept=0)) + --&gt;
&lt;!--   geom_point()  --&gt;
&lt;!-- ``` --&gt;


&lt;!-- ## Another Solution  --&gt;
&lt;!-- For a numeric approach, we could compute means across subjects for each week and compare those values: --&gt;

&lt;!-- ```{r purl=FALSE} --&gt;
&lt;!-- ffm &lt;- french_fries %&gt;%  --&gt;
&lt;!--   group_by(time) %&gt;%  --&gt;
&lt;!--   summarise(potato = mean(potato,  na.rm=TRUE), --&gt;
&lt;!--             buttery = mean(buttery,  na.rm=TRUE), --&gt;
&lt;!--             painty = mean(painty,  na.rm=TRUE)) --&gt;

&lt;!-- ffm --&gt;
&lt;!-- ``` --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Another Solution (cont) --&gt;

&lt;!-- ```{r fig.height=3,  purl=FALSE} --&gt;

&lt;!-- ffm %&gt;% --&gt;
&lt;!--   ggplot(aes(x = time, y = potato)) +  --&gt;
&lt;!--   geom_point(colour = "blue", size=3) + --&gt;
&lt;!--   geom_point(aes(y = buttery), colour = "forestgreen", size=3) + --&gt;
&lt;!--   geom_point(aes(y = painty), colour = "red", size=3) + --&gt;
&lt;!--   ylab("Score") --&gt;
&lt;!-- ``` --&gt;

&lt;!-- This doesn't seem like an elegant or efficient way of answering the question: the data is in an awkward form! --&gt;

&lt;!-- --- --&gt;
&lt;!-- ## Another option --&gt;

&lt;!-- The package `GGally` has an implementation of a scatterplot matrix using ggplot2: --&gt;

&lt;!-- ```{r fig.height=4, warning=FALSE} --&gt;
&lt;!-- GGally::ggpairs(data = french_fries[ ,5:9]) --&gt;
&lt;!-- ``` --&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
