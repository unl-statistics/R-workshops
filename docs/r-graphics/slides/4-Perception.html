<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.540">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>UNL R Workshops - Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">UNL R Workshops</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-intro/index.html"> 
<span class="menu-text">Introduction to R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-graphics/index.html"> 
<span class="menu-text">Graphics with ggplot2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-format/index.html"> 
<span class="menu-text">Data Wrangling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-modeling/index.html"> 
<span class="menu-text">Modeling</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#perception" id="toc-perception" class="nav-link active" data-scroll-target="#perception">PERCEPTION</a>
  <ul class="collapse">
  <li><a href="#why-are-some-plots-easier-to-read-than-others" id="toc-why-are-some-plots-easier-to-read-than-others" class="nav-link" data-scroll-target="#why-are-some-plots-easier-to-read-than-others">Why are some plots easier to read than others?</a></li>
  <li><a href="#why-are-some-plots-easier-to-read-than-others-1" id="toc-why-are-some-plots-easier-to-read-than-others-1" class="nav-link" data-scroll-target="#why-are-some-plots-easier-to-read-than-others-1">Why are some plots easier to read than others?</a></li>
  <li><a href="#why-are-some-plots-easier-to-read-than-others-2" id="toc-why-are-some-plots-easier-to-read-than-others-2" class="nav-link" data-scroll-target="#why-are-some-plots-easier-to-read-than-others-2">Why are some plots easier to read than others?</a></li>
  <li><a href="#why-are-some-plots-easier-to-read-than-others-3" id="toc-why-are-some-plots-easier-to-read-than-others-3" class="nav-link" data-scroll-target="#why-are-some-plots-easier-to-read-than-others-3">Why are some plots easier to read than others?</a></li>
  <li><a href="#good-graphics" id="toc-good-graphics" class="nav-link" data-scroll-target="#good-graphics">Good Graphics</a></li>
  </ul></li>
  <li><a href="#gestalt-principles" id="toc-gestalt-principles" class="nav-link" data-scroll-target="#gestalt-principles">Gestalt Principles</a>
  <ul class="collapse">
  <li><a href="#what-sorts-of-relationships-are-inferred-and-under-what-circumstances" id="toc-what-sorts-of-relationships-are-inferred-and-under-what-circumstances" class="nav-link" data-scroll-target="#what-sorts-of-relationships-are-inferred-and-under-what-circumstances">What sorts of relationships are inferred, and under what circumstances?</a></li>
  <li><a href="#which-has-more-structure" id="toc-which-has-more-structure" class="nav-link" data-scroll-target="#which-has-more-structure">Which has more structure?</a></li>
  <li><a href="#gestalt-principles-1" id="toc-gestalt-principles-1" class="nav-link" data-scroll-target="#gestalt-principles-1">Gestalt principles</a></li>
  <li><a href="#gestalt-principles-2" id="toc-gestalt-principles-2" class="nav-link" data-scroll-target="#gestalt-principles-2">Gestalt principles</a></li>
  <li><a href="#gestalt-principles-3" id="toc-gestalt-principles-3" class="nav-link" data-scroll-target="#gestalt-principles-3">Gestalt principles</a></li>
  <li><a href="#gestalt-principles-case-study" id="toc-gestalt-principles-case-study" class="nav-link" data-scroll-target="#gestalt-principles-case-study">Gestalt Principles: Case Study</a></li>
  <li><a href="#gestalt-principles-case-study-1" id="toc-gestalt-principles-case-study-1" class="nav-link" data-scroll-target="#gestalt-principles-case-study-1">Gestalt Principles: Case Study</a></li>
  <li><a href="#gestalt-principles-case-study-2" id="toc-gestalt-principles-case-study-2" class="nav-link" data-scroll-target="#gestalt-principles-case-study-2">Gestalt Principles: Case Study</a></li>
  <li><a href="#gestalt-principles-case-study-3" id="toc-gestalt-principles-case-study-3" class="nav-link" data-scroll-target="#gestalt-principles-case-study-3">Gestalt Principles: Case Study</a></li>
  </ul></li>
  <li><a href="#pre-attentive-features" id="toc-pre-attentive-features" class="nav-link" data-scroll-target="#pre-attentive-features">Pre-Attentive Features</a>
  <ul class="collapse">
  <li><a href="#pre-attentive-features-1" id="toc-pre-attentive-features-1" class="nav-link" data-scroll-target="#pre-attentive-features-1">Pre-Attentive Features</a></li>
  <li><a href="#pre-attentive-features-2" id="toc-pre-attentive-features-2" class="nav-link" data-scroll-target="#pre-attentive-features-2">Pre-Attentive Features</a></li>
  <li><a href="#pre-attentive-features-3" id="toc-pre-attentive-features-3" class="nav-link" data-scroll-target="#pre-attentive-features-3">Pre-Attentive Features</a></li>
  <li><a href="#pre-attentive-features-4" id="toc-pre-attentive-features-4" class="nav-link" data-scroll-target="#pre-attentive-features-4">Pre-attentive Features</a></li>
  <li><a href="#pre-attentive-features-5" id="toc-pre-attentive-features-5" class="nav-link" data-scroll-target="#pre-attentive-features-5">Pre-attentive Features</a></li>
  </ul></li>
  <li><a href="#color" id="toc-color" class="nav-link" data-scroll-target="#color">Color</a>
  <ul class="collapse">
  <li><a href="#color-1" id="toc-color-1" class="nav-link" data-scroll-target="#color-1">Color</a></li>
  <li><a href="#color-blindness" id="toc-color-blindness" class="nav-link" data-scroll-target="#color-blindness">Color blindness</a></li>
  <li><a href="#context" id="toc-context" class="nav-link" data-scroll-target="#context">Context</a></li>
  <li><a href="#color-implications-and-guidelines" id="toc-color-implications-and-guidelines" class="nav-link" data-scroll-target="#color-implications-and-guidelines">Color: Implications and Guidelines</a></li>
  </ul></li>
  <li><a href="#ordering-variables" id="toc-ordering-variables" class="nav-link" data-scroll-target="#ordering-variables">Ordering Variables</a></li>
  <li><a href="#aesthetics-in-ggplot2" id="toc-aesthetics-in-ggplot2" class="nav-link" data-scroll-target="#aesthetics-in-ggplot2">Aesthetics in <code>ggplot2</code></a>
  <ul class="collapse">
  <li><a href="#aesthetics-in-ggplot2-1" id="toc-aesthetics-in-ggplot2-1" class="nav-link" data-scroll-target="#aesthetics-in-ggplot2-1">Aesthetics in <code>ggplot2</code></a></li>
  <li><a href="#aesthetics-in-ggplot2-2" id="toc-aesthetics-in-ggplot2-2" class="nav-link" data-scroll-target="#aesthetics-in-ggplot2-2">Aesthetics in <code>ggplot2</code></a></li>
  <li><a href="#scales" id="toc-scales" class="nav-link" data-scroll-target="#scales">Scales</a></li>
  <li><a href="#gradients" id="toc-gradients" class="nav-link" data-scroll-target="#gradients">Gradients</a></li>
  <li><a href="#more-gradients" id="toc-more-gradients" class="nav-link" data-scroll-target="#more-gradients">More Gradients</a></li>
  <li><a href="#factors-vs.-continuous-variables" id="toc-factors-vs.-continuous-variables" class="nav-link" data-scroll-target="#factors-vs.-continuous-variables">Factors vs.&nbsp;Continuous variables</a></li>
  <li><a href="#color-in-ggplot2" id="toc-color-in-ggplot2" class="nav-link" data-scroll-target="#color-in-ggplot2">Color in ggplot2</a></li>
  <li><a href="#color-in-ggplot2-1" id="toc-color-in-ggplot2-1" class="nav-link" data-scroll-target="#color-in-ggplot2-1">Color in ggplot2</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn">Your Turn</a></li>
  <li><a href="#your-turn-1" id="toc-your-turn-1" class="nav-link" data-scroll-target="#your-turn-1">Your Turn</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="4-Perception.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Visualization</h1>
<p class="subtitle lead">Using ggplot2</p>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="perception" class="level1">
<h1>PERCEPTION</h1>
<section id="why-are-some-plots-easier-to-read-than-others" class="level2">
<h2 class="anchored" data-anchor-id="why-are-some-plots-easier-to-read-than-others">Why are some plots easier to read than others?</h2>
<p>What makes bad figures bad?</p>
<ul>
<li>issues can be (1) aesthetic, (2) substantive, and/or (3) perceptual</li>
</ul>
<div class="notes">
<p>We have now learned about how to create a graphic, but how do we know if we are creating a “good” graphic? A chart is good if it allows the user to draw useful conclusions that are supported by data. Aesthetics choices, substantive content, or perceptual biases may affect the clarity of plots.</p>
</div>
</section>
<section id="why-are-some-plots-easier-to-read-than-others-1" class="level2">
<h2 class="anchored" data-anchor-id="why-are-some-plots-easier-to-read-than-others-1">Why are some plots easier to read than others?</h2>
<p>What makes bad figures bad?</p>
<ul>
<li><p>issues can be (1) <strong>aesthetic</strong>, (2) substantive, and/or (3) perceptual <br><br></p></li>
<li><p>Edward R. Tufte is a better known critic of this style of visualization</p></li>
<li><p>Graphical excellence is the well-designed presentation of interesting data and consists of:</p>
<ul>
<li><p>complex ideas communicated with clarity, precision, and efficiency</p></li>
<li><p>maximizes the “data-to-ink” ratio.</p></li>
<li><p>nearly always multivariate</p></li>
<li><p>requires telling the truth about the data.</p></li>
</ul></li>
<li><p>defines “chartjunk” as superfluous details</p></li>
</ul>
<div class="notes">
<p>In learning how to create a graphic, we have seen there are many decisions we make when designing a graphic: the type of chart, colors, shapes, scales, etc. These aesthetic design choices we make can impact the way the chart is read. Edward Tufte has publically been a critic of chart design advocating for the most simplistic chart to minimize “chartjunk”. While chartjunk is not entirely devoid of merit, bear in mind that ease of recall is only one virtue amongst many for graphics.</p>
</div>
</section>
<section id="why-are-some-plots-easier-to-read-than-others-2" class="level2">
<h2 class="anchored" data-anchor-id="why-are-some-plots-easier-to-read-than-others-2">Why are some plots easier to read than others?</h2>
<p>What makes bad figures bad?</p>
<ul>
<li><p>issues can be (1) aesthetic, (2) <strong>substantive</strong>, and/or (3) perceptual <br><br></p></li>
<li><p>bad data</p></li>
</ul>
<div class="notes">
<p>A good graphic can’t fix bad data. Recall that we create graphics by mapping the variables in the data set to attributes on the chart, what is in the data set shows up in the figure.</p>
</div>
</section>
<section id="why-are-some-plots-easier-to-read-than-others-3" class="level2">
<h2 class="anchored" data-anchor-id="why-are-some-plots-easier-to-read-than-others-3">Why are some plots easier to read than others?</h2>
<p>What makes bad figures bad?</p>
<ul>
<li><p>issues can be (1) aesthetic, (2) substantive, and/or (3) <strong>perceptual </strong> <br><br></p></li>
<li><p>Looking at pictures of data means looking at lines, shapes, and colors</p></li>
<li><p>Our visual system works in a way that makes some things easier for us to see than others</p></li>
<li><p>“Preattentive” features</p></li>
<li><p>Gestalt Principles</p></li>
<li><p>color and contrast</p></li>
</ul>
<div class="notes">
<p>When interpreting a graphic, we are visually observing different features of the figure. While our visual system is <em>amazing</em>, it is not always as accurate as the computers we use to render graphics. We have physical limits in the number of colors we can perceive, our short term memory, attention, and our ability to accurately read information off of charts in different forms. We will discuss how an understanding of preattentive features and the gestalt principles can help us make decisions about how to display our data in order to reduce the cognitive load necessary to interpret a plot.</p>
</div>
</section>
<section id="good-graphics" class="level2">
<h2 class="anchored" data-anchor-id="good-graphics">Good Graphics</h2>
<p>Graphics consist of:</p>
<ul>
<li><p><strong>Structure</strong>: boxplot, scatterplot, etc.</p></li>
<li><p><strong>Aesthetics</strong>: features such as color, shape, and size that map other characteristics to structural features</p></li>
</ul>
<p>Both the structure and aesthetics should help viewers interpret the information.</p>
</section>
</section>
<section id="gestalt-principles" class="level1 inverse">
<h1 class="inverse">Gestalt Principles</h1>
<section id="what-sorts-of-relationships-are-inferred-and-under-what-circumstances" class="level3">
<h3 class="anchored" data-anchor-id="what-sorts-of-relationships-are-inferred-and-under-what-circumstances">What sorts of relationships are inferred, and under what circumstances?</h3>
</section>
<section id="which-has-more-structure" class="level2">
<h2 class="anchored" data-anchor-id="which-has-more-structure">Which has more structure?</h2>
<div class="cell" data-fig.position="center">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/rand-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>We look for structure all the time. We are so good at it that we will find it in random data, given time. (This is one of the reasons that data visualization can hardly be a replacement for statistical modeling.) The strong inferences we make about relationships between visual elements from relatively sparse visual information are called “gestalt rules”. They are not pure perceptual effects, like the checkerboard illusions. Rather, they describe our tendency to infer relationships between the objects we are looking at in a way that goes beyond what is strictly visible.</p>
</div>
</section>
<section id="gestalt-principles-1" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-1">Gestalt principles</h2>
<p><img src="images/gestalt3.jpg" class="img-fluid"></p>
<div class="notes">
<p>gestalt = form or pattern Gestalt philosophy: the whole is greater than the sum of the parts</p>
<p>Gestalt principles: Predictable ways by which we organize sensory information.</p>
</div>
</section>
<section id="gestalt-principles-2" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-2">Gestalt principles</h2>
<p>What sorts of relationships are inferred, and under what circumstances?</p>
<ul>
<li><p><strong>Proximity</strong>: Things that are spatially near to one another are related.</p></li>
<li><p><strong>Similarity</strong>: Things that look alike are related.</p></li>
<li><p><strong>Enlosure</strong>: A group of related elements are surrounded with a visual element</p></li>
<li><p><strong>Symmetry</strong>: If an object is asymmetrical, the viewer will waste time trying to find the problem instead of concentrating on the instruction.</p></li>
<li><p><strong>Closure</strong>: Incomplete shapes are perceived as complete.</p></li>
<li><p><strong>Continuity</strong>: Partially hidden objects are completed into familiar shapes.</p></li>
<li><p><strong>Connection</strong>: Things that are visually tied to one another are related.</p></li>
<li><p><strong>Figure/Ground</strong>: Visual elements are either in the foreground or the background.</p></li>
</ul>
</section>
<section id="gestalt-principles-3" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-3">Gestalt principles</h2>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Gestalt Hierarchy</th>
<th style="text-align: left;">Graphs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Enclosure</td>
<td style="text-align: left;">Facets</td>
</tr>
<tr class="even">
<td style="text-align: left;">Connection</td>
<td style="text-align: left;">Lines</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Proximitiy</td>
<td style="text-align: left;">White Space</td>
</tr>
<tr class="even">
<td style="text-align: left;">Similarity</td>
<td style="text-align: left;">Color/Shape</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Implications for practice</strong> + Know how we perceive groups + Know that we perceive some groups before others + Design to facilitate and emphasize the most important comparisons</p>
</section>
<section id="gestalt-principles-case-study" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-case-study">Gestalt Principles: Case Study</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>swimming <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/unl-statistics/R-workshops/main/r-graphics/data/gestalt-swimming.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/swimming.png" class="img-fluid"></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Location   WaterTemp     Time      AvgTemp     
 cheek:6   indoor :12   pre  :8   Min.   :48.60  
 elbow:6   outdoor:12   post1:8   1st Qu.:67.67  
 palm :6                post2:8   Median :84.25  
 pec  :6                          Mean   :78.70  
                                  3rd Qu.:89.83  
                                  Max.   :95.40  </code></pre>
</div>
</div>
</section>
<section id="gestalt-principles-case-study-1" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-case-study-1">Gestalt Principles: Case Study</h2>
<p><strong>Research question:</strong> Does the average body temperature recovery as recorded at the four body points depend on water temperature?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/swimming-plots1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gestalt-principles-case-study-2" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-case-study-2">Gestalt Principles: Case Study</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/swimming-plots2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gestalt-principles-case-study-3" class="level2">
<h2 class="anchored" data-anchor-id="gestalt-principles-case-study-3">Gestalt Principles: Case Study</h2>
<p><strong>Research question:</strong> Does the average body temperature recovery as recorded at the four body points depend on water temperature?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/swimming-plots3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/swimming-plots4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="pre-attentive-features" class="level1 inverse">
<h1 class="inverse">Pre-Attentive Features</h1>
<section id="pre-attentive-features-1" class="level2">
<h2 class="anchored" data-anchor-id="pre-attentive-features-1">Pre-Attentive Features</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>how quickly did you spot the circle?</p>
</div>
</section>
<section id="pre-attentive-features-2" class="level2">
<h2 class="anchored" data-anchor-id="pre-attentive-features-2">Pre-Attentive Features</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>Did you spot the green point quicker than the circle in the previous image?</p>
</div>
</section>
<section id="pre-attentive-features-3" class="level2">
<h2 class="anchored" data-anchor-id="pre-attentive-features-3">Pre-Attentive Features</h2>
<p>Pre-Attentive Features are things that “jump out” in less than 250 ms</p>
<ul>
<li>Color, form, movement, spatial localization</li>
</ul>
<p>There is a hierarchy of features</p>
<ul>
<li><p>Color is stronger than shape</p></li>
<li><p>Combinations of pre-attentive features are usually not pre-attentive due to <strong>interference</strong></p></li>
</ul>
</section>
<section id="pre-attentive-features-4" class="level2">
<h2 class="anchored" data-anchor-id="pre-attentive-features-4">Pre-attentive Features</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pre-attentive-features-5" class="level2">
<h2 class="anchored" data-anchor-id="pre-attentive-features-5">Pre-attentive Features</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="color" class="level1">
<h1>Color</h1>
<ul>
<li><p><strong>Hue</strong>: shade of color (red, orange, yellow…)</p></li>
<li><p><strong>Intensity</strong>: amount of color</p></li>
<li><p>Both color and hue are pre-attentive. Bigger contrast corresponds to faster detection.</p></li>
<li><p>Use color to your advantage</p></li>
<li><p>When choosing color schemes, we will want mappings from data to color that are not just numerically but also <strong><em>perceptually</em></strong> uniform</p></li>
<li><p>Distinguish between sequential scales and categorical scales</p></li>
</ul>
<section id="color-1" class="level2">
<h2 class="anchored" data-anchor-id="color-1">Color</h2>
<p>Our eyes are optimized for perceiving the yellow/green region of the color spectrum.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/color.svg" class="img-fluid figure-img"></p>
<figcaption>Sensitivity of the human eye to different wavelengths of visual light (Image from Wikimedia commons)</figcaption>
</figure>
</div>
<div class="notes">
<p>Our eyes are optimized for perceiving the yellow/green region of the color spectrum. Why? Well, our sun produces yellow light, and plants tend to be green. It’s pretty important to be able to distinguish different shades of green (evolutionarily speaking) because it impacts your ability to feed yourself. There aren’t that many purple or blue predators, so there is less selection pressure to improve perception of that part of the visual spectrum.</p>
</div>
</section>
<section id="color-blindness" class="level2">
<h2 class="anchored" data-anchor-id="color-blindness">Color blindness</h2>
<p>Not everyone perceives color in the same way. Some individuals have <a href="https://en.wikipedia.org/wiki/Color_blindness">colorblindness or color deficiencies</a>.</p>
<p>You can take a test designed to screen for colorblindness <a href="https://www.eyeque.com/color-blind-test/test/">here</a>.</p>
<p><img src="images/color-blindness.png" class="img-fluid"></p>
</section>
<section id="context" class="level2">
<h2 class="anchored" data-anchor-id="context">Context</h2>
<p>Color is context-sensitive: A and B are the same intensity and hue, but appear to be different.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shadow-illusion3.jpg" class="img-fluid figure-img"></p>
<figcaption>Edward Adelson’s checkershadow illusion</figcaption>
</figure>
</div>
<div class="notes">
<p>In addition to colorblindness, there are other factors than the actual color value which are important in how we experience color, such as context.</p>
<p>Our brains are extremely dependent on context and make excellent use of the large amounts of experience we have with the real world. As a result, we implicitly “remove” the effect of things like shadows as we make sense of the input to the visual system. This can result in odd things, like the checkerboard and shadow shown above - because we’re correcting for the shadow, B looks lighter than A even though when the context is removed they are clearly the same shade.</p>
</div>
</section>
<section id="color-implications-and-guidelines" class="level2">
<h2 class="anchored" data-anchor-id="color-implications-and-guidelines">Color: Implications and Guidelines</h2>
<ul>
<li><p>Do not use rainbow color gradient schemes.</p></li>
<li><p>Avoid any scheme that uses green-yellow-red signaling if you have a target audience that may include colorblind people.</p></li>
<li><p>To “colorblind-proof” a graphic, you can use a couple of strategies:</p>
<ul>
<li>double encoding - where you use color, use another aesthetic (line type, shape)</li>
<li>If you can print your chart out in black and white and still read it, it will be safe for colorblind users. This is the only foolproof way to do it!</li>
<li>If you are using a color gradient, use a monochromatic color scheme where possible.</li>
<li>If you have a bidirectional scale (e.g.&nbsp;showing positive and negative values), the safest scheme to use is purple - white - orange. In any color scale that is multi-hue, it is important to transition through white, instead of from one color to another directly.</li>
</ul></li>
<li><p>Be conscious of what certain colors “mean”</p></li>
</ul>
<div class="notes">
<ul>
<li><p>Do not use rainbow color gradient schemes - because of the unequal perception of different wavelengths, these schemes are misleading - the color distance does not match the perceptual distance.</p></li>
<li><p>Avoid any scheme that uses green-yellow-red signaling if you have a target audience that may include colorblind people.</p></li>
<li><p>To “colorblind-proof” a graphic, you can use a couple of strategies:</p>
<ul>
<li>double encoding - where you use color, use another aesthetic (line type, shape) as well to help your colorblind readers out</li>
<li>If you can print your chart out in black and white and still read it, it will be safe for colorblind users. This is the only foolproof way to do it!</li>
<li>If you are using a color gradient, use a monochromatic color scheme where possible. This is perceived as light -&gt; dark by colorblind people, so it will be correctly perceived no matter what color you use.</li>
<li>If you have a bidirectional scale (e.g.&nbsp;showing positive and negative values), the safest scheme to use is purple - white - orange. In any color scale that is multi-hue, it is important to transition through white, instead of from one color to another directly.</li>
</ul></li>
<li><p>Be conscious of what certain colors “mean”</p>
<ul>
<li>Leveraging common associations can make it easier to read a color scale and remember what it stands for (e.g.&nbsp;blue for cold, orange/red for hot is a natural scale, red = Republican and blue = Democrat in the US, white -&gt; blue gradients for showing rainfall totals)</li>
<li>Some colors can can provoke emotional responses that may not be desirable.</li>
<li>It is also important to be conscious of the social baggage that certain color schemes may have - the pink/blue color scheme often used to denote gender can be unnecessarily polarizing, and it may be easier to use a colder color (blue or purple) for men and a warmer color (yellow, orange, lighter green) for women.</li>
</ul></li>
<li><p>There are packages such as <code>RColorBrewer</code> and <code>dichromat</code> that have color palettes which are aesthetically pleasing, and, in many cases, colorblind friendly (<code>dichromat</code> is better for that than <code>RColorBrewer</code>). You can also take a look at other <a href="https://lisacharlotterost.de/2016/04/22/Colors-for-DataVis/">ways to find nice color palettes</a>.</p></li>
</ul>
</div>
</section>
</section>
<section id="ordering-variables" class="level1">
<h1>Ordering Variables</h1>
<p>Which is bigger?</p>
<ul>
<li>Position: higher is bigger (y), items to the right are bigger (x)</li>
<li>Size, Area</li>
<li>Color: not always ordered. More contrast = bigger.</li>
<li>Shape: Unordered.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="1920"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aesthetics-in-ggplot2" class="level1 inverse">
<h1 class="inverse">Aesthetics in <code>ggplot2</code></h1>
<section id="aesthetics-in-ggplot2-1" class="level2">
<h2 class="anchored" data-anchor-id="aesthetics-in-ggplot2-1">Aesthetics in <code>ggplot2</code></h2>
<p><strong>Aesthetics</strong>: features such as color, shape, and size that map other characteristics to structural features</p>
<p><img src="images/aesthetics.png" class="img-fluid"></p>
</section>
<section id="aesthetics-in-ggplot2-2" class="level2">
<h2 class="anchored" data-anchor-id="aesthetics-in-ggplot2-2">Aesthetics in <code>ggplot2</code></h2>
<p><strong>Scales</strong> map data values to the visual values of an aesthetic</p>
<ul>
<li>to change a mapping, add a new scale</li>
</ul>
<p><img src="images/scales1.png" class="img-fluid"></p>
</section>
<section id="scales" class="level2">
<h2 class="anchored" data-anchor-id="scales">Scales</h2>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="images/scales2.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="images/scales3.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="gradients" class="level2">
<h2 class="anchored" data-anchor-id="gradients">Gradients</h2>
<p>Qualitative schemes: no more than 7 colors</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="smaller">Can use <code>colorRampPalette()</code> from the RColorBrewer package to produce larger palettes by interpolating existing ones</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Quantitative schemes: use color gradient with only one hue for positive values</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="more-gradients" class="level2">
<h2 class="anchored" data-anchor-id="more-gradients">More Gradients</h2>
<p>Quantitative schemes: use color gradient with two hues for positive and negative values. Gradient should go through a light, neutral color (white)</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Small objects or thin lines need more contrast than larger areas</p>
</section>
<section id="factors-vs.-continuous-variables" class="level2">
<h2 class="anchored" data-anchor-id="factors-vs.-continuous-variables">Factors vs.&nbsp;Continuous variables</h2>
<ul>
<li>Factor variable:
<ul>
<li><code>scale_colour_discrete</code></li>
<li><code>scale_colour_brewer(palette = ...)</code></li>
</ul></li>
<li>Continuous variable:
<ul>
<li><code>scale_colour_gradient</code> (define low, high values)</li>
<li><code>scale_colour_gradient2</code> (define low, mid, and high values)</li>
<li>Equivalents for fill: <code>scale_fill_...</code></li>
</ul></li>
</ul>
<div class="cell" data-layout-align="top">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-top">
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-top figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="color-in-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="color-in-ggplot2">Color in ggplot2</h2>
<p>There are packages available for use that have color scheme options.</p>
<p>Some Examples:</p>
<ul>
<li>Rcolorbrewer</li>
<li>ggsci</li>
<li>viridis</li>
<li>wes anderson</li>
</ul>
<p>There are packages such as <code>RColorBrewer</code> and <code>dichromat</code> that have color palettes which are aesthetically pleasing, and, in many cases, colorblind friendly.</p>
<p>You can also take a look at other <a href="https://lisacharlottemuth.com/2016/04/22/Colors-for-DataVis/">ways to find nice color palettes</a>.</p>
</section>
<section id="color-in-ggplot2-1" class="level2">
<h2 class="anchored" data-anchor-id="color-in-ggplot2-1">Color in ggplot2</h2>
<ul>
<li>There are packages available for use that have color schemes options.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="4-Perception_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="your-turn" class="level2 inverse">
<h2 class="inverse anchored" data-anchor-id="your-turn">Your Turn</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(diamonds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>In the <code>diamonds</code> data, <code>clarity</code> and <code>cut</code> are ordinal, while <code>price</code> and <code>carat</code> are continuous.</p></li>
<li><p>Create a graphic that gives an overview of these four variables while respecting their types.</p></li>
<li><p>Discuss your graphic with a neighbor.</p></li>
</ul>
</section>
<section id="your-turn-1" class="level2 inverse">
<h2 class="inverse anchored" data-anchor-id="your-turn-1">Your Turn</h2>
<p>The <code>movies</code> data set contains information from IMDB.com including ratings, genre, length in minutes, and year of release.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/unl-statistics/R-workshops/main/r-graphics/data/MovieSummary.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Explore the differences in length, rating, etc. in movie genres over time.</p></li>
<li><p><strong>Hint:</strong> use faceting!</p></li>
<li><p>Discuss your graphic with a neighbor.</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>