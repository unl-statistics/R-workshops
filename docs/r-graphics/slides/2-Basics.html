<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.540">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>UNL R Workshops - Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint/kePrint.js"></script>
<link href="../../site_libs/lightable/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">UNL R Workshops</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-intro/index.html"> 
<span class="menu-text">Introduction to R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-graphics/index.html"> 
<span class="menu-text">Graphics with ggplot2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-format/index.html"> 
<span class="menu-text">Data Wrangling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r-modeling/index.html"> 
<span class="menu-text">Modeling</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#basics" id="toc-basics" class="nav-link active" data-scroll-target="#basics">BASICS</a>
  <ul class="collapse">
  <li><a href="#why-is-data-visualization-important" id="toc-why-is-data-visualization-important" class="nav-link" data-scroll-target="#why-is-data-visualization-important">Why is data visualization important?</a></li>
  <li><a href="#anscombes-quartet" id="toc-anscombes-quartet" class="nav-link" data-scroll-target="#anscombes-quartet">Anscombe’s Quartet</a></li>
  <li><a href="#anscombes-quartet-data" id="toc-anscombes-quartet-data" class="nav-link" data-scroll-target="#anscombes-quartet-data">Anscombe’s Quartet: data</a></li>
  <li><a href="#anscombes-quartet-summary-statistics" id="toc-anscombes-quartet-summary-statistics" class="nav-link" data-scroll-target="#anscombes-quartet-summary-statistics">Anscombe’s Quartet: summary statistics</a></li>
  <li><a href="#anscombes-quartet-plots" id="toc-anscombes-quartet-plots" class="nav-link" data-scroll-target="#anscombes-quartet-plots">Anscombe’s Quartet: plots</a></li>
  </ul></li>
  <li><a href="#data-types-formats-and-structures" id="toc-data-types-formats-and-structures" class="nav-link" data-scroll-target="#data-types-formats-and-structures">Data Types, Formats, and Structures</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#data-levels-of-measurement" id="toc-data-levels-of-measurement" class="nav-link" data-scroll-target="#data-levels-of-measurement">Data: levels of measurement</a></li>
  <li><a href="#data-dimensionality-form-and-type" id="toc-data-dimensionality-form-and-type" class="nav-link" data-scroll-target="#data-dimensionality-form-and-type">Data: Dimensionality, Form, and Type</a></li>
  <li><a href="#exploring-relationships" id="toc-exploring-relationships" class="nav-link" data-scroll-target="#exploring-relationships">Exploring Relationships</a></li>
  </ul></li>
  <li><a href="#formating-your-data" id="toc-formating-your-data" class="nav-link" data-scroll-target="#formating-your-data">Formating your data</a>
  <ul class="collapse">
  <li><a href="#a-tidy-data-discussion" id="toc-a-tidy-data-discussion" class="nav-link" data-scroll-target="#a-tidy-data-discussion">A tidy data discussion</a></li>
  <li><a href="#data-format" id="toc-data-format" class="nav-link" data-scroll-target="#data-format">Data format</a></li>
  <li><a href="#same-data-different-layouts" id="toc-same-data-different-layouts" class="nav-link" data-scroll-target="#same-data-different-layouts">Same data, different layouts</a></li>
  <li><a href="#wide-format-vs.-long-format" id="toc-wide-format-vs.-long-format" class="nav-link" data-scroll-target="#wide-format-vs.-long-format">Wide Format vs.&nbsp;Long Format</a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy Data</a></li>
  <li><a href="#tidy-data-1" id="toc-tidy-data-1" class="nav-link" data-scroll-target="#tidy-data-1">Tidy Data</a></li>
  <li><a href="#messy-data" id="toc-messy-data" class="nav-link" data-scroll-target="#messy-data">Messy data</a></li>
  <li><a href="#messy-data-1" id="toc-messy-data-1" class="nav-link" data-scroll-target="#messy-data-1">Messy data</a></li>
  <li><a href="#tidy-your-data" id="toc-tidy-your-data" class="nav-link" data-scroll-target="#tidy-your-data">Tidy your data</a></li>
  <li><a href="#tidy-your-data-1" id="toc-tidy-your-data-1" class="nav-link" data-scroll-target="#tidy-your-data-1">Tidy your data</a></li>
  </ul></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn">Your turn!</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="2-Basics.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Visualization</h1>
<p class="subtitle lead">Using ggplot2</p>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="basics" class="level1">
<h1>BASICS</h1>
<section id="why-is-data-visualization-important" class="level2">
<h2 class="anchored" data-anchor-id="why-is-data-visualization-important">Why is data visualization important?</h2>
<p><br></p>
<p>Exploratory Data Analysis (EDA)</p>
<p><br></p>
<p>Examples:</p>
<ul>
<li>Anscombe’s Quartet Exercise</li>
</ul>
</section>
<section id="anscombes-quartet" class="level2">
<h2 class="anchored" data-anchor-id="anscombes-quartet">Anscombe’s Quartet</h2>
<ul>
<li><p>4 data sets that have nearly identical simple statistical properties that appear very different when graphed</p></li>
<li><p>demonstrate both the importance of graphing data before analyzing it and the effect of outliers on statistical properties</p></li>
<li><p>11 (x,y) points</p></li>
<li><h2 id="the-same-mean-median-standard-deviation-and-correlation-coefficient-between-x-and-y" class="anchored">the same mean, median, standard deviation, and correlation coefficient between x and y</h2></li>
</ul>
</section>
<section id="anscombes-quartet-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="anscombes-quartet-data">Anscombe’s Quartet: data</h2>
<div class="columns">
<div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Set I</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">8.04</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">6.95</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">7.58</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">8.81</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">8.33</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">9.96</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">7.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">4.26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">10.84</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">4.82</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.68</td>
</tr>
</tbody>
</table>


</div>
</div>
</div><div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Set II</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">9.14</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">8.14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">8.74</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">8.77</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">9.26</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">8.10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">6.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">9.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">7.26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.74</td>
</tr>
</tbody>
</table>


</div>
</div>
</div><div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Set III</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">7.46</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">6.77</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">12.74</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: right;">7.11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">7.81</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">8.84</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">6.08</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">5.39</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: right;">8.15</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">6.42</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.73</td>
</tr>
</tbody>
</table>


</div>
</div>
</div><div class="column" style="width:25%;">
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Set IV</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">6.58</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">5.76</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">7.71</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">8.84</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">8.47</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">7.04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">5.25</td>
</tr>
<tr class="even">
<td style="text-align: right;">19</td>
<td style="text-align: right;">12.50</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">5.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">7.91</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">6.89</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</div>
</section>
<section id="anscombes-quartet-summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="anscombes-quartet-summary-statistics">Anscombe’s Quartet: summary statistics</h2>
<p><br> <br></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">I</th>
<th style="text-align: left;">II</th>
<th style="text-align: left;">III</th>
<th style="text-align: left;">IV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mean(x)</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">sd(x)</td>
<td style="text-align: left;">3.32</td>
<td style="text-align: left;">3.32</td>
<td style="text-align: left;">3.32</td>
<td style="text-align: left;">3.32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mean(y)</td>
<td style="text-align: left;">7.5</td>
<td style="text-align: left;">7.5</td>
<td style="text-align: left;">7.5</td>
<td style="text-align: left;">7.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">sd(y)</td>
<td style="text-align: left;">2.03</td>
<td style="text-align: left;">2.03</td>
<td style="text-align: left;">2.03</td>
<td style="text-align: left;">2.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cor(x,y)</td>
<td style="text-align: left;">0.82</td>
<td style="text-align: left;">0.82</td>
<td style="text-align: left;">0.82</td>
<td style="text-align: left;">0.82</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="notes">
<p>each data set has the same mean, standard deviation, and correlation coefficient between x and y.</p>
</div>
</section>
<section id="anscombes-quartet-plots" class="level2">
<h2 class="anchored" data-anchor-id="anscombes-quartet-plots">Anscombe’s Quartet: plots</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2-Basics_files/figure-html/quartet-plots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>plot y versus x for each set with a linear regression trendline displayed on each plot:</p>
<p>This classic example really illustrates the importance of looking at your data, not just the summary statistics and model parameters you compute from it.</p>
</div>
</section>
</section>
<section id="data-types-formats-and-structures" class="level1 inverse">
<h1 class="inverse">Data Types, Formats, and Structures</h1>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>Before it’s possible to talk about a graphical grammar, it’s important to know the type and format of the data you’re working with.</p>
<table class="table">
<tbody>
<tr class="odd">
<td>Why?</td>
</tr>
</tbody>
</table>
<ul>
<li><p>the data contains all of the information you’re trying to convey</p></li>
<li><p>the appropriate graphical techniques depend on the kind of data that you are working with</p></li>
<li><p>Working with R and ggplot is much easier if the data you use is in the right shape.</p></li>
</ul>
</section>
<section id="data-levels-of-measurement" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="data-levels-of-measurement">Data: levels of measurement</h2>
<div class="columns">
<div class="column">
<p><strong>Quantitative</strong>:</p>
<ul>
<li>Continuous
<ul>
<li>e.g.&nbsp;height, weight</li>
</ul></li>
<li>Discrete
<ul>
<li>e.g.&nbsp;age in years<br>
</li>
</ul></li>
</ul>
</div><div class="column">
<p><strong>Qualitative</strong>:<br>
- Nominal<br>
- categories have no meaningful order</p>
<pre><code>-   e.g. colors</code></pre>
<ul>
<li>Ordinal
<ul>
<li><p>categories have order but no meaningful distance between categories</p></li>
<li><p>e.g.&nbsp;five star ratings</p></li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="data-dimensionality-form-and-type" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="data-dimensionality-form-and-type">Data: Dimensionality, Form, and Type</h2>
<div class="columns">
<div class="column">
<p><strong>Dimensions</strong></p>
<ul>
<li>Univariate
<ul>
<li>1 variable</li>
</ul></li>
<li>Bivariate
<ul>
<li>2 variables</li>
</ul></li>
<li>Multivariate
<ul>
<li>2+ variables</li>
</ul></li>
</ul>
<p><strong>Forms</strong></p>
<ul>
<li><p>Traditional</p></li>
<li><p>Aggregated</p></li>
</ul>
</div><div class="column">
<p><strong>Types</strong></p>
<ul>
<li><p>Count</p>
<ul>
<li><p>Word Frequency</p></li>
<li><p>Sports Statistics</p></li>
</ul></li>
<li><p>Time Series</p></li>
<li><p>Spatial</p></li>
<li><p>Time to Event</p>
<ul>
<li><p>Survival</p></li>
<li><p>Reliability</p></li>
</ul></li>
<li><p>Categorical</p></li>
</ul>
</div>
</div>
</section>
<section id="exploring-relationships" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="exploring-relationships">Exploring Relationships</h2>
<ul>
<li>Continuous vs.&nbsp;Continuous
<ul>
<li>scatter plot, line plot</li>
</ul></li>
<li>Continuous vs.&nbsp;Categorical
<ul>
<li>boxplots, dotcharts, multiple density plots, violin plots</li>
</ul></li>
<li>Categorical vs.&nbsp;Categorical
<ul>
<li>mosaicplots, side-by-side barplots</li>
</ul></li>
<li>Multidimensional</li>
</ul>
<p><br></p>
<p><strong>Resources</strong></p>
<ul>
<li><p><a href="https://datavizproject.com/">The Data Vis Project</a></p></li>
<li><p><a href="https://datavizcatalogue.com/">Data Visualization Catalogue</a></p></li>
</ul>
</section>
</section>
<section id="formating-your-data" class="level1 inverse">
<h1 class="inverse">Formating your data</h1>
<section id="a-tidy-data-discussion" class="level3">
<h3 class="anchored" data-anchor-id="a-tidy-data-discussion">A tidy data discussion</h3>
</section>
<section id="data-format" class="level2">
<h2 class="anchored" data-anchor-id="data-format">Data format</h2>
<ul>
<li><p>Working with R and ggplot is much easier if the data you use is in the right shape.</p></li>
<li><p>Unlike base graphics, ggplot works with dataframes and not individual vectors.</p></li>
<li><p>All the data needed to make the plot is typically contained within the dataframe</p></li>
<li><p>ggplot expects your data to be in a particular sort of shape - “tidy data”</p></li>
</ul>
</section>
<section id="same-data-different-layouts" class="level2">
<h2 class="anchored" data-anchor-id="same-data-different-layouts">Same data, different layouts</h2>
<p><font size="5"></font></p><font size="5">
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Option 1:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 19%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Treatment A</th>
<th>Treatment B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>John Smith</td>
<td>NA</td>
<td>18</td>
</tr>
<tr class="even">
<td>Jane Doe</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Mary Johnson</td>
<td>6</td>
<td>7</td>
</tr>
</tbody>
</table>
<p><strong>Option 2:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Treatment</th>
<th>John Smith</th>
<th>Jane Doe</th>
<th>Mary Johnson</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><pre><code> A</code></pre></td>
<td>NA</td>
<td>4</td>
<td>6</td>
</tr>
<tr class="even">
<td><pre><code> B</code></pre></td>
<td>18</td>
<td>1</td>
<td>7</td>
</tr>
</tbody>
</table>
</div><div class="column" style="width:50%;">
<p><strong>Option 3:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Treatment</th>
<th>Measurement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>John Smith</td>
<td>A</td>
<td>NA</td>
</tr>
<tr class="even">
<td>John Smith</td>
<td>B</td>
<td>18</td>
</tr>
<tr class="odd">
<td>Jane Doe</td>
<td>A</td>
<td>4</td>
</tr>
<tr class="even">
<td>Jane Doe</td>
<td>B</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Mary Johnson</td>
<td>A</td>
<td>6</td>
</tr>
<tr class="even">
<td>Mary Johnson</td>
<td>B</td>
<td>7</td>
</tr>
</tbody>
</table>
</div>
</div>
</font><p><font size="5"></font></p>
<div class="notes">
<p>The data is the same, but the layout is different. Our vocabulary of rows and columns is simply not rich enough to describe why the two tables represent the same data. In addition to appearance, we need a way to describe the underlying semantics, or meaning, of the values displayed in the table</p>
</div>
</section>
<section id="wide-format-vs.-long-format" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="wide-format-vs.-long-format">Wide Format vs.&nbsp;Long Format</h2>
<div class="columns">
<div class="column">
<p><strong>Wide format</strong></p>
<ul>
<li><p>some variables are spread out across columns.</p></li>
<li><p>typically uses less space to display</p></li>
<li><p>how you would typically choose to present your data</p></li>
<li><p>far less repetition of labels and row elements</p></li>
</ul>
<p><img src="images/tablewide2.png" class="img-fluid"></p>
</div><div class="column">
<p><strong>Long format</strong></p>
<ul>
<li><p>each variable is a column</p></li>
<li><p>each observation is a row</p></li>
<li><p>is likely not the data’s most compact form</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2-Basics_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="tidy-data" class="level2 r-fit-text">
<h2 class="r-fit-text anchored" data-anchor-id="tidy-data">Tidy Data</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tidy-data-0.jpg" class="quarto-figure quarto-figure-center figure-img" alt="Tidy Data" width="800" height="550"></p>
<figcaption>Like families…, by <a href="https://www.allisonhorst.com/">Allison Horst</a></figcaption>
</figure>
</div>
</section>
<section id="tidy-data-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="tidy-data-1">Tidy Data</h2>
<ul>
<li><p>Each variable is a column</p></li>
<li><p>Each observation is a row</p></li>
<li><p>Each type of observational unit forms a table</p></li>
</ul>
<p><font size="5"></font></p><font size="5">
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Treatment</th>
<th>Measurement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>John Smith</td>
<td>A</td>
<td>NA</td>
</tr>
<tr class="even">
<td>John Smith</td>
<td>B</td>
<td>18</td>
</tr>
<tr class="odd">
<td>Jane Doe</td>
<td>A</td>
<td>4</td>
</tr>
<tr class="even">
<td>Jane Doe</td>
<td>B</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Mary Johnson</td>
<td>A</td>
<td>6</td>
</tr>
<tr class="even">
<td>Mary Johnson</td>
<td>B</td>
<td>7</td>
</tr>
</tbody>
</table>
</font><p><font size="5"></font></p>
</section>
<section id="messy-data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="messy-data">Messy data</h2>
<p><em>Happy families are all alike; every unhappy family is unhappy in its own way. - Leo Tolstoy</em><br>
<img src="images/tidy-data.jpg" class="quarto-figure quarto-figure-center" alt="Tidy Data" width="800" height="500"></p>
</section>
<section id="messy-data-1" class="level2">
<h2 class="anchored" data-anchor-id="messy-data-1">Messy data</h2>
<p><em>Happy families are all alike; every unhappy family is unhappy in its own way. - Leo Tolstoy</em></p>
<p><strong>Five main ways tables of data tend not to be tidy:</strong></p>
<ol type="1">
<li><p>Column headers are values, not variable names.</p></li>
<li><p>Multiple variables are stored in one column.</p></li>
<li><p>Variables are stored in both rows and columns.</p></li>
<li><p>Multiple types of observational units are stored in the same table.</p></li>
<li><p>A single observational unit is stored in multiple tables.</p></li>
</ol>
</section>
<section id="tidy-your-data" class="level2">
<h2 class="anchored" data-anchor-id="tidy-your-data">Tidy your data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(french_fries, <span class="at">package =</span> <span class="st">"reshape2"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(french_fries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Wide Format:</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rep</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">potato</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">buttery</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">grassy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rancid</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">painty</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">5.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">10</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.2</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">5.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">15</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8.8</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.3</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="tidy-your-data-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="tidy-your-data-1">Tidy your data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>french_fries_long <span class="ot">&lt;-</span> french_fries <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"potato"</span><span class="sc">:</span><span class="st">"painty"</span>), <span class="co">#&lt;&lt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="co">#&lt;&lt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="co">#&lt;&lt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(french_fries_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Long Format:</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rep</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">potato</td>
<td style="text-align: right;">2.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">buttery</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">grassy</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">rancid</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">painty</td>
<td style="text-align: right;">5.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">potato</td>
<td style="text-align: right;">14.0</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>More on tidy data later!</p>
</section>
</section>
<section id="your-turn" class="level1 inverse">
<h1 class="inverse">Your turn!</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">outcome =</span> <span class="fu">c</span>(<span class="st">"success"</span>, <span class="st">"failure"</span>),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">dog =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">10</span>),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">cat =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">12</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>experiment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  outcome   dog   cat
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 success    15    20
2 failure    10    12</code></pre>
</div>
</div>
<p>To tidy the <code>experiment</code> table use <code>pivot_longer()</code> to create a long table.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>