---
title: "Data Visualization"
subtitle: "Using ggplot2"
output:
  xaringan::moon_reader:
    # css: [default, rladies]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(	echo = FALSE,
	message = FALSE,
	warning = FALSE,
	cache = TRUE
)
```

```{r}
library(ggplot2)
library(ggsci)
library(ggthemes)
library(gridExtra)
library(grid)

grid_arrange_shared_legend <- function(..., ncol = length(list(...)), nrow = 1, position = c("bottom", "right")) {

  plots <- list(...)
  position <- match.arg(position)
  g <- ggplotGrob(plots[[1]] + theme(legend.position = position))$grobs
  legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
  lheight <- sum(legend$height)
  lwidth <- sum(legend$width)
  gl <- lapply(plots, function(x) x + theme(legend.position="none"))
  gl <- c(gl, ncol = ncol, nrow = nrow)

  combined <- switch(position,
                     "bottom" = arrangeGrob(do.call(arrangeGrob, gl),
                                            legend,
                                            ncol = 1,
                                            heights = unit.c(unit(1, "npc") - lheight, lheight)),
                     "right" = arrangeGrob(do.call(arrangeGrob, gl),
                                           legend,
                                           ncol = 2,
                                           widths = unit.c(unit(1, "npc") - lwidth, lwidth)))
  
  grid.newpage()
  grid.draw(combined)

  # return gtable invisibly
  invisible(combined)

}

```

class: center, middle

# BASICS

---

# Why is data visualization important?
<br/>

Exploratory Data Analysis (EDA)

<br/>

Examples:  

- Anscombe's Quartet Exercise


---

# Anscombe's Quartet

-  4 data sets that have nearly identical simple statistical properties that appear very different when graphed

- demonstrate both the importance of graphing data before analyzing it and the effect of outliers on statistical properties

- 11 (x,y) points

- the same mean, median, standard deviation, and correlation coefficient between x and y
---

# Anscombe's Quartet: data

.pull-left[
.pull-left[
```{r, anscombe-set1}
quartet_setI <- anscombe %>%
  select(x1, y1) %>%
  mutate(set = "I") %>%
  rename(x = x1, 
         y = y1)
quartet_setI %>% select(x, y) %>% knitr::kable(caption = "Set I")
```
].pull-right[
```{r anscombe-set2}
quartet_setII <- anscombe %>%
  select(x2, y2) %>%
  mutate(set = "II") %>%
  rename(x = x2, 
         y = y2)
quartet_setII %>% select(x, y) %>% knitr::kable(caption = "Set II")
```
]].pull-right[
.pull-left[
```{r anscombe-set3}
quartet_setIII <- anscombe %>%
  select(x3, y3) %>%
  mutate(set = "III") %>%
  rename(x = x3, 
         y = y3)
quartet_setIII %>% select(x, y) %>% knitr::kable(caption = "Set III")
```
].pull-right[
```{r anscombe-set4}
quartet_setIV <- anscombe %>%
  select(x4, y4) %>%
  mutate(set = "IV") %>%
  rename(x = x4, 
         y = y4)
quartet_setIV %>% select(x, y) %>% knitr::kable(caption = "Set IV")
```
]]

---

# Anscombe's Quartet: summary statistics

<br>
<br>

```{r, quartet-summary}
quartet <- rbind(quartet_setI,
                 quartet_setII,
                 quartet_setIII,
                 quartet_setIV) %>%
  select(set, x, y)

quartet_summary <- quartet %>%
  group_by(set) %>%
  summarize("mean(x)"  = round(mean(x),2), 
            "sd(x)"    = round(sd(x),2), 
            "mean(y)"  = round(mean(y),2), 
            "sd(y)"    = round(sd(y),2), 
            "cor(x,y)" = round(cor(x,y),2)) %>% 
  t()

colnames(quartet_summary) <- quartet_summary[1,]
quartet_summary <- quartet_summary[-1,] %>%
  as.data.frame()

quartet_summary %>%
  knitr::kable(digits = 2)
```
???

each data set has the same mean, standard deviation, and correlation coefficient between x and y.
 
---

# Anscombe's Quartet: plots

```{r, , quartet-plots, fig.height = 7, fig.width = 7, fig.align = "center"}
ggplot(quartet, aes(x, y)) + 
  geom_point(colour = "green4", size = 2.5) + 
  geom_smooth(method = lm, se = FALSE, colour = "gray", alpha = .5) +
  facet_wrap(~ set) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text = element_text(size = 14),
        axis.title = element_text(size = 16),
        strip.text = element_text(size = 16))
```


???

plot y versus x for each set with a linear regression trendline displayed on each plot:

This classic example really illustrates the importance of looking at your data, not just the summary statistics and model parameters you compute from it.

---
class: center, middle, inverse

# Data Types, Formats, and Structures

---

# Data

Before it’s possible to talk about a graphical grammar, it’s important to know the type and format of the data you’re working with.  
  
<br/>

--
Why?
--

- the data contains all of the information you’re trying to convey

- the appropriate graphical techniques depend on the kind of data that you are working with

- Working with R and ggplot is much easier if the data you use is in the right shape.

---

# Data: levels of measurement

.pull-left[
**Quantitative**:

- Continuous
  - e.g. height, weight
  
- Discrete  
  - e.g. age in years  
]
.pull-right[
**Qualitative**:

- Nominal
  - categories have no meaningful order  
  
  - e.g. colors
  
- Ordinal
  - categories have order but no meaningful distance between categories
  
  - e.g. five star ratings
]

---

# Data: Dimensionality, Form, and Type

.pull-left[
**Dimensions**

- Univariate  
  - 1 variable

- Bivariate  
  - 2 variables

- Multivariate
  - 2+ variables

**Forms**

- Traditional  

- Aggregated
]
.pull-right[
**Types**

- Count  

  - Word Frequency  

  - Sports Statistics  

- Time Series  

- Spatial  

- Time to Event  

  - Survival  
  
  - Reliability  
  
- Categorical 

]
---

# Exploring Relationships

- Continuous vs. Continuous  
  - scatter plot, line plot
  
- Continuous vs. Categorical  
  - boxplots, dotcharts, multiple density plots, violin plots

- Categorical vs. Categorical  
  - mosaicplots, side-by-side barplots
  
- Multidimensional

<br>

**Resources**
+ [The Data Vis Project](https://datavizproject.com/)
+ [Data Visualization Catalogue](https://datavizcatalogue.com/)



---
class: center, middle, inverse

# Formating your data: 

## A tidy data discussion

---

# Data format 

- Working with R and ggplot is much easier if the data you use is in the right shape.

- Unlike base graphics, ggplot works with dataframes and not individual vectors. 

- All the data needed to make the plot is typically contained within the dataframe 

- ggplot expects your data to be in a particular sort of shape - "tidy data"

---

# Same data, different layouts

.pull-left[
**Option 1:**
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-s6z2{text-align:center}
.tg .tg-gmsq{background-color:#FCFBE3;font-style:italic;text-align:center}
.tg .tg-lyaj{background-color:#FCFBE3;text-align:center}
.tg .tg-hgcj{font-weight:bold;text-align:center}
</style>
<table class="tg">
  <tr>
    <th class="tg-hgcj">Name</th>
    <th class="tg-hgcj">Treatment A</th>
    <th class="tg-hgcj">Treatment B</th>
  </tr>
  <tr>
    <td class="tg-s6z2">John Smith</td>
    <td class="tg-gmsq">NA</td>
    <td class="tg-s6z2">18</td>
  </tr>
  <tr>
    <td class="tg-s6z2">Jane Doe</td>
    <td class="tg-lyaj">4</td>
    <td class="tg-s6z2">1</td>
  </tr>
  <tr>
    <td class="tg-s6z2">Mary Johnson</td>
    <td class="tg-lyaj">6</td>
    <td class="tg-s6z2">7</td>
  </tr>
</table>

<br/>

**Option 2:**

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}
.tg .tg-yq6s{background-color:#FCFBE3;text-align:center;vertical-align:top}
</style>
<table class="tg">
  <tr>
    <th class="tg-amwm">Treatment</th>
    <th class="tg-amwm">John Smith</th>
    <th class="tg-amwm">Jane Doe</th>
    <th class="tg-amwm">Mary Johnson</th>
  </tr>
  <tr>
    <td class="tg-yq6s">A</td>
    <td class="tg-yq6s">NA</td>
    <td class="tg-yq6s">4</td>
    <td class="tg-yq6s">6</td>
  </tr>
  <tr>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">18</td>
    <td class="tg-baqh">1</td>
    <td class="tg-baqh">7</td>
  </tr>
</table>
]
.pull-right[
**Option 3:**

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-s6z2{text-align:center}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-hgcj{font-weight:bold;text-align:center}
</style>
<table class="tg">
  <tr>
    <th class="tg-hgcj">Name</th>
    <th class="tg-hgcj">Treatment</th>
    <th class="tg-hgcj">Measurement</th>
  </tr>
  <tr>
    <td class="tg-s6z2">John Smith</td>
    <td class="tg-s6z2">A</td>
    <td class="tg-s6z2">NA</td>
  </tr>
  <tr>
    <td class="tg-s6z2">Jane Doe</td>
    <td class="tg-s6z2">A</td>
    <td class="tg-s6z2">4</td>
  </tr>
  <tr>
    <td class="tg-baqh">Mary Johnson</td>
    <td class="tg-baqh">A</td>
    <td class="tg-baqh">6</td>
  </tr>
  <tr>
    <td class="tg-baqh">John Smith</td>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">18</td>
  </tr>
  <tr>
    <td class="tg-baqh">Jane Doe</td>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">1</td>
  </tr>
  <tr>
    <td class="tg-baqh">Mary Johnson</td>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">7</td>
  </tr>
</table>
]

```{r, eval = FALSE}
preg <- read.csv("data/preg.csv", stringsAsFactors = FALSE)
preg
knitr::kable(preg, format = 'html')
preg2 <- read.csv("data/preg2.csv", stringsAsFactors = FALSE)
preg2
knitr::kable(preg2, format = 'html')

preg3 <- preg %>% gather(treatment, measurement, -name)
preg3

```



???

The data is the same, but the layout is different. Our vocabulary of rows and columns is simply not rich enough to describe why the two tables represent the same data. In addition to appearance, we need a way to describe the underlying semantics, or meaning, of the values displayed in the table

---


# Wide Format vs. Long Format

.pull-left[
**Wide format**

- some variables are spread out across columns.

- typically uses less space to display

- how you would typically choose to present your data

- far less repetition of labels and row elements


![](images/tablewide2.png)

]
.pull-right[

**Long format**

- each variable is a column

- each observation is a row

- is likely not the data's most compact form


```{r fig.width=3, fig.height=3.7,echo=FALSE, fig.align="center"}
library(png)
library(grid)
img <- readPNG("images/tablelong2.png")
 grid.raster(img)
```

]

---

# Tidy Data


- Each variable is a column

- Each observation is a row

- Each type of observational unit forms a table

<br/>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#aaa;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}
</style>
<table class="tg">
  <tr>
    <th class="tg-amwm">Name</th>
    <th class="tg-amwm">Treatment</th>
    <th class="tg-amwm">Measurement</th>
  </tr>
  <tr>
    <td class="tg-baqh">John Smith</td>
    <td class="tg-baqh">A</td>
    <td class="tg-baqh">NA</td>
  </tr>
  <tr>
    <td class="tg-baqh">John Smith</td>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">18</td>
  </tr>
  <tr>
    <td class="tg-baqh">Jane Doe</td>
    <td class="tg-baqh">A</td>
    <td class="tg-baqh">4</td>
  </tr>
  <tr>
    <td class="tg-baqh">Jane Doe</td>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">1</td>
  </tr>
  <tr>
    <td class="tg-baqh">Mary Johnson</td>
    <td class="tg-baqh">A</td>
    <td class="tg-baqh">6</td>
  </tr>
  <tr>
    <td class="tg-baqh">Mary Johnson</td>
    <td class="tg-baqh">B</td>
    <td class="tg-baqh">7</td>
  </tr>
</table>


---

# Messy data

 *Happy families are all alike; every unhappy family is unhappy in its own way. - Leo Tolstoy*  
<br/>
--

**Five main ways tables of data tend not to be tidy:**

1. Column headers are values, not variable names.

2. Multiple variables are stored in one column.

3. Variables are stored in both rows and columns.

4. Multiple types of observational units are stored in the same table.

5. A single observational unit is stored in multiple tables.


---

# Tidy your data


```{r, eval=FALSE, echo=TRUE}
data(french_fries, package = "reshape2")
head(french_fries)
```

**Wide Format:**

```{r, eval=T, echo=F}
library(reshape2)
data(french_fries)
head(french_fries)%>% knitr::kable(row.names = F)
```

---

# Tidy your data

```{r, eval=FALSE, echo=TRUE}
french_fries_long <- french_fries %>% 
  pivot_longer(cols = c("potato":"painty"), #<<
               names_to = "variable", #<<
               values_to = "value") #<<
head(french_fries_long)
```

**Long Format:**

```{r, eval=T, echo=F}
french_fries_long <- french_fries %>% 
  pivot_longer(cols = c("potato":"painty"),
               names_to = "variable",
               values_to = "value")
head(french_fries_long) %>% knitr::kable(row.names = F)
```

<br>
More on tidy data later! 

---
class: inverse
# Your turn!

```{r preg, echo = T, eval = T}
preg <- tibble(pregnant = c("yes", "no"),
               male = c(NA, 10),
               female = c(20, 12))
preg
```

To tidy the `preg` table use `pivot_longer()` to create a long table.

